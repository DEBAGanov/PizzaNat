# Google Sheets API - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## üöÄ –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø—É—Å–∫—É

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Cloud Platform

1. **–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç** –≤ [Google Cloud Console](https://console.cloud.google.com)
2. **–í–∫–ª—é—á–∏—Ç–µ Google Sheets API**:
   - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ ‚Üí –ü–æ–∏—Å–∫ "Google Sheets API" ‚Üí –í–∫–ª—é—á–∏—Ç—å
3. **–°–æ–∑–¥–∞–π—Ç–µ Service Account**:
   - IAM –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí Service Accounts ‚Üí –°–æ–∑–¥–∞—Ç—å
   - –°–∫–∞—á–∞–π—Ç–µ JSON —Ñ–∞–π–ª —Å –∫–ª—é—á–∞–º–∏

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google –¢–∞–±–ª–∏—Ü—ã

1. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É** –≤ [Google Sheets](https://sheets.google.com)
2. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID —Ç–∞–±–ª–∏—Ü—ã** –∏–∑ URL:
   ```
   https://docs.google.com/spreadsheets/d/1ABC123def456GHI789jkl/edit
   ‚Ü≥ ID: 1ABC123def456GHI789jkl
   ```
3. **–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Ç–∞–±–ª–∏—Ü–µ–π** —Å –≤–∞—à–∏–º Service Account email (–ø—Ä–∞–≤–∞: –†–µ–¥–∞–∫—Ç–æ—Ä)

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

1. **–ü–æ–º–µ—Å—Ç–∏—Ç–µ credentials —Ñ–∞–π–ª**:
   ```bash
   mkdir -p config/
   cp /path/to/your/credentials.json config/google-credentials.json
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª**:
   ```bash
   cp .env.google-sheets-template .env.google-sheets
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à SPREADSHEET_ID
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å Google Sheets**:
   ```bash
   docker-compose --env-file .env.google-sheets up
   ```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export GOOGLE_SHEETS_ENABLED=true
export GOOGLE_SHEETS_SPREADSHEET_ID="–≤–∞—à_id_—Ç–∞–±–ª–∏—Ü—ã"

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
./scripts/test_google_sheets_integration.sh
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à—É Google —Ç–∞–±–ª–∏—Ü—É**
2. **–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑** —á–µ—Ä–µ–∑ API –∏–ª–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–∫–∞–∑ –ø–æ—è–≤–∏–ª—Å—è** –≤ —Ç–∞–±–ª–∏—Ü–µ

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ

| –ö–æ–ª–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|---------|----------|--------|
| A | ID –∑–∞–∫–∞–∑–∞ | 123 |
| B | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è | 28.01.2025 14:30 |
| C | –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ | –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ |
| D | –¢–µ–ª–µ—Ñ–æ–Ω | +79991234567 |
| E | Email | ivan@example.com |
| F | –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ | –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞ x2 (1200‚ÇΩ); –ö–æ–ª–∞ x1 (150‚ÇΩ) |
| G | –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ | —É–ª. –õ–µ–Ω–∏–Ω–∞, 10 |
| H | –¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏ | –ö—É—Ä—å–µ—Ä–æ–º |
| I | –°—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ | 1350‚ÇΩ |
| J | –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ | 200‚ÇΩ |
| K | –û–±—â–∞—è —Å—É–º–º–∞ | 1550‚ÇΩ |
| L | –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã | –°–ë–ü |
| M | –°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ | –û–ø–ª–∞—á–µ–Ω |
| N | –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω |
| O | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π | –ë–µ–∑ –ª—É–∫–∞ |
| P | –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–ª–∞—Ç–µ–∂ | https://yoomoney.ru/... |

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```yaml
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
GOOGLE_SHEETS_ENABLED=true
GOOGLE_SHEETS_SPREADSHEET_ID=–≤–∞—à_id_—Ç–∞–±–ª–∏—Ü—ã
GOOGLE_SHEETS_SHEET_NAME=–ó–∞–∫–∞–∑—ã

# –ü—É—Ç–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
GOOGLE_SHEETS_CREDENTIALS_PATH=/app/config/google-credentials.json
GOOGLE_SHEETS_APPLICATION_NAME=PizzaNat Order Tracker

# –¢–∞–π–º-–∞—É—Ç—ã –∏ –ø–æ–≤—Ç–æ—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
GOOGLE_SHEETS_CONNECT_TIMEOUT=10000
GOOGLE_SHEETS_READ_TIMEOUT=30000
GOOGLE_SHEETS_MAX_RETRY_ATTEMPTS=3
GOOGLE_SHEETS_RETRY_DELAY=1000
```

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞: "403 Forbidden"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Service Account –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å "–†–µ–¥–∞–∫—Ç–æ—Ä")

### –û—à–∏–±–∫–∞: "404 Not Found"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å SPREADSHEET_ID
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–∞

### –û—à–∏–±–∫–∞: "401 Unauthorized"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å credentials.json —Ñ–∞–π–ª–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –ø—É—Ç–∏

### –ó–∞–∫–∞–∑—ã –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: `docker-compose logs app`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ GOOGLE_SHEETS_ENABLED=true
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ GoogleSheetsService –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–º. [GOOGLE_SHEETS_INTEGRATION_GUIDE.md](./GOOGLE_SHEETS_INTEGRATION_GUIDE.md)