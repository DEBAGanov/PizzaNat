# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ "Contact is already requested"

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
```
Error: WebAppContactRequested
[Telegram.WebApp] Contact is already requested
```

Telegram API –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å `requestContact()` –ø–æ–≤—Ç–æ—Ä–Ω–æ, –µ—Å–ª–∏ –æ–Ω —É–∂–µ –±—ã–ª –≤—ã–∑–≤–∞–Ω —Ä–∞–Ω–µ–µ. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ `WebAppContactRequested`.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. **–î–æ–±–∞–≤–ª–µ–Ω —Ñ–ª–∞–≥ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è**
```javascript
this.contactRequested = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –≤—ã–∑–æ–≤–æ–º requestContact()**
–í–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö, –≥–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `this.tg.requestContact()`:

```javascript
if (!this.contactRequested) {
    this.tg.requestContact();
    this.contactRequested = true;
} else {
    console.log('‚ö†Ô∏è requestContact —É–∂–µ –±—ã–ª –≤—ã–∑–≤–∞–Ω —Ä–∞–Ω–µ–µ');
    this.showManualPhoneInput();
}
```

### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ WebAppContactRequested**
```javascript
catch (error) {
    if (error.message === 'WebAppContactRequested') {
        console.log('‚ÑπÔ∏è –ö–æ–Ω—Ç–∞–∫—Ç —É–∂–µ –±—ã–ª –∑–∞–ø—Ä–æ—à–µ–Ω —Ä–∞–Ω–µ–µ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥');
        this.contactRequested = true;
    }
    this.showManualPhoneInput();
}
```

### 4. **–°–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞**
```javascript
// –í handleContactReceived()
this.contactRequested = false;
console.log('üîÑ –§–ª–∞–≥ contactRequested —Å–±—Ä–æ—à–µ–Ω - –∫–æ–Ω—Ç–∞–∫—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω');

// –í submitManualPhone()
this.contactRequested = false;
console.log('üîÑ –§–ª–∞–≥ contactRequested —Å–±—Ä–æ—à–µ–Ω - –Ω–æ–º–µ—Ä –≤–≤–µ–¥–µ–Ω –≤—Ä—É—á–Ω—É—é');
```

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `checkout-app.js` - –æ—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã:
1. ‚úÖ `requestContactAgain()` - –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞
2. ‚úÖ `loadUserData()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ–∑–∞–ø—Ä–æ—Å–µ
3. ‚úÖ `handleMissingUserData()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ `submitOrder()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
5. ‚úÖ `handleContactReceived()` - —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
6. ‚úÖ `submitManualPhone()` - —Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –ø—Ä–∏ —Ä—É—á–Ω–æ–º –≤–≤–æ–¥–µ

## üì± –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞:
1. `contactRequested = false` ‚úÖ
2. –í—ã–∑–æ–≤ `requestContact()` ‚úÖ  
3. `contactRequested = true` ‚úÖ
4. –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è `contactRequested` ‚è≥

### –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞:
1. –°–æ–±—ã—Ç–∏–µ `contactRequested` –ø–æ–ª—É—á–µ–Ω–æ ‚úÖ
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `userData.phone` ‚úÖ
3. `contactRequested = false` (—Å–±—Ä–æ—Å —Ñ–ª–∞–≥–∞) üîÑ
4. –ö–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" –∞–∫—Ç–∏–≤–Ω–∞ ‚úÖ

### –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞: `contactRequested = false` ‚úÖ
2. –ú–æ–∂–Ω–æ —Å–Ω–æ–≤–∞ –≤—ã–∑–≤–∞—Ç—å `requestContact()` ‚úÖ

### –ï—Å–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç —É–∂–µ –∑–∞–ø—Ä–æ—à–µ–Ω:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞: `contactRequested = true` ‚ö†Ô∏è
2. –ü—Ä–æ–ø—É—Å–∫ `requestContact()` ‚ö†Ô∏è
3. –ü–æ–∫–∞–∑ —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –Ω–æ–º–µ—Ä–∞ üìù

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏:
```javascript
üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø:
  - this.contactRequested: false/true
  - typeof this.tg.requestContact: function
  - Telegram WebApp version: 7.7
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞:**
- ‚ùå –ë–æ–ª—å—à–µ –Ω–µ—Ç –æ—à–∏–±–∫–∏ "WebAppContactRequested"
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º –µ—â–µ —Ä–∞–∑" —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞–∂–∞—Ç–∏—è—Ö –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä—É—á–Ω–æ–π –≤–≤–æ–¥
- ‚úÖ –§–ª–∞–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞

### ‚úÖ **–£–ª—É—á—à–µ–Ω–∏—è UX:**
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- Fallback –∫ —Ä—É—á–Ω–æ–º—É –≤–≤–æ–¥—É –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- –†–∞–±–æ—Ç–∞–µ—Ç —Å Telegram API 7.7
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
- Graceful fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üìÖ –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 27.01.2025
