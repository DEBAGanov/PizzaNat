# üìÑ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —á–µ–∫–æ–≤ –Æ–ö–∞—Å—Å–∞ —Å–æ–≥–ª–∞—Å–Ω–æ 54-–§–ó

## üéØ –û–±–∑–æ—Ä

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–æ–≤ —Å –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –Æ–ö–∞—Å—Å–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ ‚Ññ 54-–§–ó "–û –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ-–∫–∞—Å—Å–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏".

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–≤–∞—Ä–∞—Ö –∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ –≤ –Æ–ö–∞—Å—Å—É
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –Æ–ö–∞—Å—Å—ã
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ URL —á–µ–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã

---

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è 54-–§–ó

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã —á–µ–∫–∞:
1. **–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞/—É—Å–ª—É–≥–∏** - –¥–æ 128 —Å–∏–º–≤–æ–ª–æ–≤
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞** - —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "X.XX"
3. **–¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É** - —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ —Ä—É–±–ª—è—Ö
4. **–°—É–º–º–∞ –ø–æ –ø–æ–∑–∏—Ü–∏–∏** - –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏
5. **–°—Ç–∞–≤–∫–∞ –ù–î–°** - –∫–æ–¥ —Å—Ç–∞–≤–∫–∏ –ù–î–° (1-4)
6. **–ü—Ä–∏–∑–Ω–∞–∫ –ø—Ä–µ–¥–º–µ—Ç–∞ —Ä–∞—Å—á–µ—Ç–∞** - —Ç–∏–ø —Ç–æ–≤–∞—Ä–∞/—É—Å–ª—É–≥–∏
7. **–ü—Ä–∏–∑–Ω–∞–∫ —Å–ø–æ—Å–æ–±–∞ —Ä–∞—Å—á–µ—Ç–∞** - —Ç–∏–ø –æ–ø–ª–∞—Ç—ã

### –î–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è:
- **–ü–æ–ª–Ω–æ–µ –∏–º—è** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - –§–ò–û –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –¥–ª—è —á–µ–∫–∞
- **–¢–µ–ª–µ—Ñ–æ–Ω** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - –Ω–æ–º–µ—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7XXXXXXXXXX
- **Email** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```mermaid
graph TB
    A[–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞] --> B[–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤]
    B --> C[–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞]
    C --> D[–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–∞]
    D --> E[–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –Æ–ö–∞—Å—Å—É]
    E --> F[–ü–æ–ª—É—á–µ–Ω–∏–µ URL —á–µ–∫–∞]
    F --> G[Webhook –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è]
    G --> H[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞]
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

#### 1. YooKassaReceiptDto
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: DTO –∫–ª–∞—Å—Å—ã –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —á–µ–∫–∞

```java
@Data
@Builder
public class YooKassaReceiptDto {
    private CustomerDto customer;      // –î–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
    private List<ReceiptItemDto> items; // –¢–æ–≤–∞—Ä–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
}
```

#### 2. YooKassaPaymentService
**–ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–µ–∫–∞–º–∏**:
- `buildReceipt(Order order)` - —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–∞ –∏–∑ –∑–∞–∫–∞–∑–∞
- `buildReceiptItem(OrderItem item)` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —á–µ–∫–∞
- `normalizePhoneNumber(String phone)` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–µ–∫–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ –∫ –Æ–ö–∞—Å—Å–µ

```json
{
  "amount": {
    "value": "1000.00",
    "currency": "RUB"
  },
  "description": "–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ ‚Ññ123",
  "receipt": {
    "customer": {
      "full_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
      "phone": "+79001234567"
    },
    "items": [
      {
        "description": "–ü–∏—Ü—Ü–∞ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞",
        "quantity": "2.00",
        "amount": {
          "value": "800.00",
          "currency": "RUB"
        },
        "vat_code": 1,
        "payment_subject": "commodity",
        "payment_mode": "full_payment"
      },
      {
        "description": "–î–æ—Å—Ç–∞–≤–∫–∞",
        "quantity": "1.00",
        "amount": {
          "value": "200.00",
          "currency": "RUB"
        },
        "vat_code": 1,
        "payment_subject": "service",
        "payment_mode": "full_payment"
      }
    ]
  }
}
```

### 2. –ö–æ–¥—ã –ù–î–°

| –ö–æ–¥ | –°—Ç–∞–≤–∫–∞ –ù–î–° | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|------------|----------|
| 1   | 0%         | –ù–î–° –Ω–µ –æ–±–ª–∞–≥–∞–µ—Ç—Å—è |
| 2   | 10%        | –ù–î–° 10% |
| 3   | 20%        | –ù–î–° 20% |
| 4   | –ë–µ–∑ –ù–î–°    | –ù–î–° –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è |

**–î–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –µ–¥—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–¥ 1 (0%)**

### 3. –ü—Ä–∏–∑–Ω–∞–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–∞ —Ä–∞—Å—á–µ—Ç–∞

| –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| commodity | –¢–æ–≤–∞—Ä |
| service | –£—Å–ª—É–≥–∞ |
| job | –†–∞–±–æ—Ç–∞ |
| excise | –ü–æ–¥–∞–∫—Ü–∏–∑–Ω—ã–π —Ç–æ–≤–∞—Ä |

### 4. –§–æ—Ä–º–∞—Ç—ã —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:

```java
// –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
+79001234567     // –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
89001234567      // –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç —Å 8
79001234567      // –ë–µ–∑ –ø–ª—é—Å–∞
9001234567       // –ë–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã
+7 (900) 123-45-67  // –° —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏
8 900 123 45 67    // –° –ø—Ä–æ–±–µ–ª–∞–º–∏

// –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏: +79001234567
```

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —Å —á–µ–∫–æ–º

```http
POST /api/v1/payments/yookassa/create
Authorization: Bearer {jwt_token}
Content-Type: application/json

{
  "orderId": 123,
  "method": "SBP",
  "description": "–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ ‚Ññ123 –≤ PizzaNat"
}
```

**–û—Ç–≤–µ—Ç —Å —á–µ–∫–æ–º:**
```json
{
  "id": 1001,
  "yookassaPaymentId": "2c5aa890-000f-5000-8000-18db351245c7",
  "orderId": 123,
  "status": "PENDING",
  "method": "SBP",
  "amount": 1000.00,
  "confirmationUrl": "https://yookassa.ru/checkout/payments/...",
  "receiptUrl": null,
  "createdAt": "2025-01-19T10:00:00Z"
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ URL —á–µ–∫–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —á–µ–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–æ—Å—Ç—É–ø–µ–Ω:

```http
GET /api/v1/payments/yookassa/{paymentId}
Authorization: Bearer {jwt_token}
```

**–û—Ç–≤–µ—Ç —Å URL —á–µ–∫–∞:**
```json
{
  "id": 1001,
  "status": "SUCCEEDED",
  "receiptUrl": "https://receipt.yookassa.ru/...",
  "paidAt": "2025-01-19T10:05:00Z"
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
chmod +x scripts/test_yookassa_receipt_integration.sh
./scripts/test_yookassa_receipt_integration.sh
```

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

#### 1. –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á–µ–∫–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ URL —á–µ–∫–∞

#### 2. –¢–µ—Å—Ç —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
- ‚úÖ –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: +79001234567
- ‚úÖ –†–æ—Å—Å–∏–π—Å–∫–∏–π —Å 8: 89001234567
- ‚úÖ –ë–µ–∑ –ø–ª—é—Å–∞: 79001234567
- ‚úÖ –ö—Ä–∞—Ç–∫–∏–π: 9001234567
- ‚úÖ –° —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏: +7 (900) 123-45-67

#### 3. –¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –ó–∞–∫–∞–∑ —Å 5+ —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
- ‚úÖ –†–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π

#### 4. –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã
- ‚úÖ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∑–∞–∫–∞–∑
- ‚úÖ –ü—É—Å—Ç–∞—è –∫–æ—Ä–∑–∏–Ω–∞

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–∞

```java
// –£—Å–ø–µ—à–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–∞
log.debug("‚úÖ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω —á–µ–∫ –¥–ª—è –∑–∞–∫–∞–∑–∞ #{}: {} –ø–æ–∑–∏—Ü–∏–π, —Ç–µ–ª–µ—Ñ–æ–Ω {}", 
          orderId, itemsCount, normalizedPhone);

// –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
log.warn("‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–∫—É–ø–∞—Ç–µ–ª—è –¥–ª—è —á–µ–∫–∞ –∑–∞–∫–∞–∑–∞ #{}", orderId);
log.warn("‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ {} –¥–ª—è —á–µ–∫–∞ –∑–∞–∫–∞–∑–∞ #{}", phone, orderId);

// –û—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è
log.error("‚ùå –û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞ #{}: {}", orderId, error);
```

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–µ–∫–æ–≤
- –ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
- –í—Ä–µ–º—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π –≤ —á–µ–∫–∞—Ö

---

## ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞
**–°–∏–º–ø—Ç–æ–º—ã**: –ß–µ–∫ –Ω–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è, –≤ –ª–æ–≥–∞—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —Ç–µ–ª–µ—Ñ–æ–Ω–µ

**–†–µ—à–µ–Ω–∏–µ**:
```java
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —Ç–µ–ª–µ—Ñ–æ–Ω–∞
String normalized = normalizePhoneNumber(phone);
if (normalized == null) {
    // –¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
}
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
**–°–∏–º–ø—Ç–æ–º—ã**: –ß–µ–∫ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–µ—Ç —Ç–æ–≤–∞—Ä–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π

**–†–µ—à–µ–Ω–∏–µ**:
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∑–∞–∫–∞–∑ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–≤–∞—Ä—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–æ–≤–∞—Ä—ã –Ω–µ null –≤ OrderItem

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
**–°–∏–º–ø—Ç–æ–º—ã**: –û—à–∏–±–∫–∞ –æ—Ç –Æ–ö–∞—Å—Å—ã –æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –æ–ø–∏—Å–∞–Ω–∏–∏

**–†–µ—à–µ–Ω–∏–µ**:
```java
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–µ–∑–∞–Ω–∏–µ –¥–æ 128 —Å–∏–º–≤–æ–ª–æ–≤
if (description.length() > 128) {
    description = description.substring(0, 125) + "...";
}
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç URL —á–µ–∫–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
**–°–∏–º–ø—Ç–æ–º—ã**: receiptUrl –æ—Å—Ç–∞–µ—Ç—Å—è null –¥–∞–∂–µ –ø–æ—Å–ª–µ SUCCEEDED

**–ü—Ä–∏—á–∏–Ω—ã**:
- –Æ–ö–∞—Å—Å–∞ –µ—â–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ–∫ (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –≤—Ä–µ–º—è)
- –û—à–∏–±–∫–∞ –≤ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —á–µ–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞

**–†–µ—à–µ–Ω–∏–µ**:
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ –æ—à–∏–±–∫–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–∞

---

## üîÑ Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —á–µ–∫–µ –≤ webhook

```java
@PostMapping("/webhook")
public ResponseEntity<Void> handleWebhook(@RequestBody JsonNode webhook) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ —á–µ–∫–µ
    if (webhook.has("object") && webhook.get("object").has("receipt_registration")) {
        JsonNode receipt = webhook.get("object").get("receipt_registration");
        
        if ("succeeded".equals(receipt.get("status").asText())) {
            String receiptUrl = receipt.get("receipt_url").asText();
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º URL —á–µ–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
        }
    }
    
    return ResponseEntity.ok().build();
}
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Æ–ö–∞—Å—Å—ã:
- [–ß–µ–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤](https://yookassa.ru/developers/payment-acceptance/receipts/54fz/other-services/payments)
- [API –æ–±—ä–µ–∫—Ç –ø–ª–∞—Ç–µ–∂–∞](https://yookassa.ru/developers/api#payment_object)
- [–ü—Ä–æ—Ü–µ—Å—Å –ø–ª–∞—Ç–µ–∂–∞](https://yookassa.ru/developers/payment-acceptance/getting-started/payment-process#capture-and-cancel)

### –ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:
- [54-–§–ó "–û –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ö–ö–¢"](http://www.consultant.ru/document/cons_doc_LAW_200318/)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–∞—Å—Å–æ–≤—ã–º —á–µ–∫–∞–º](https://normativ.kontur.ru/document?moduleId=1&documentId=347077)

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:
- `YooKassaConfig.java` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `application.yml` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `V18__create_payments_table.sql` - –º–∏–≥—Ä–∞—Ü–∏—è –ë–î

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã DTO –∫–ª–∞—Å—Å—ã –¥–ª—è —á–µ–∫–æ–≤ (YooKassaReceiptDto)
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω YooKassaPaymentService —Å –º–µ—Ç–æ–¥–∞–º–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–æ–≤
- [ ] –ü—Ä–æ–≤–µ–¥–µ–Ω—ã —Ç–µ—Å—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ–∫–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–æ–≤
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- [ ] –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ–∫–æ–≤

**üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏—Å–∫–∞–ª—å–Ω—ã—Ö —á–µ–∫–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º 54-–§–ó –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å –Æ–ö–∞—Å—Å–æ–π. 