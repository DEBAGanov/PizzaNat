# Интеграция с мобильным приложением PizzaNat

## Обзор изменений для мобильного приложения

### 🏠 Подсказки адресов

#### Новое поведение:
- **Пользователь вводит только название улицы** (без города и региона)
- **Автодополнение работает с первой буквы**
- **Показываются только названия улиц** без типа ("Ленина" вместо "улица Ленина")
- **Автоматическая фильтрация только по Волжску**

#### API Endpoint:
```
GET /api/v1/delivery/address-suggestions?query={query}
```

#### Примеры запросов:
```bash
# Поиск по первой букве
GET /api/v1/delivery/address-suggestions?query=Л
# Ответ: ["Ленина", "Лесная"]

# Поиск по части названия
GET /api/v1/delivery/address-suggestions?query=Лен
# Ответ: ["Ленина"]

# Поиск переулков
GET /api/v1/delivery/address-suggestions?query=Сад
# Ответ: ["Садовый"]
```

#### Формат ответа:
```json
[
  {
    "address": "Республика Марий Эл, Волжск, улица Ленина",
    "shortAddress": "Ленина",
    "latitude": 55.866,
    "longitude": 48.359,
    "source": "yandex",
    "metadata": "street"
  }
]
```

### 🚚 Расчет доставки

#### Новое поведение:
- **Неизвестные адреса получают стандартный тариф 250₽**
- **Бесплатная доставка для неизвестных адресов от 1200₽**
- **Нет отказов в доставке** - все адреса принимаются

#### API Endpoint:
```
POST /api/v1/delivery/estimate
```

#### Пример запроса:
```json
{
  "address": "Неизвестная улица, 1",
  "orderAmount": 500
}
```

#### Пример ответа для неизвестного адреса:
```json
{
  "zoneName": "Стандартная зона",
  "deliveryCost": 250.00,
  "isDeliveryFree": false,
  "freeDeliveryThreshold": 1200.00,
  "estimatedTime": "20-60 минут"
}
```

## Рекомендации для UI/UX

### 📱 Поле ввода адреса

1. **Заголовок**: "Введите название улицы"
2. **Плейсхолдер**: "Например: Ленина, Мира, Садовый"
3. **Автодополнение**: Показывать после ввода 1 символа
4. **Формат подсказок**: Только названия улиц без "улица", "переулок"

### 🎯 Пример интерфейса

```
┌─────────────────────────────────┐
│ 📍 Адрес доставки               │
├─────────────────────────────────┤
│ Волжск (автоматически)          │
│ ┌─────────────────────────────┐ │
│ │ Лен_                        │ │ ← Пользователь вводит
│ └─────────────────────────────┘ │
│ ↓ Подсказки:                    │
│ • Ленина                        │ ← Показывается сразу
│ • Лесная                        │
└─────────────────────────────────┘
```

### 💰 Отображение стоимости доставки

- **Известные районы**: Показывать название района и стоимость
- **Неизвестные адреса**: "Стандартная зона - 250₽"
- **Бесплатная доставка**: Показывать порог для каждой зоны

## Тестирование

### 🧪 Скрипты для тестирования

```bash
# Тестирование подсказок адресов
./test_address_suggestions.sh

# Общее тестирование системы доставки
./scripts/test_comprehensive.sh
```

### ✅ Ключевые сценарии для тестирования

1. **Поиск существующих улиц**: "Лен" → "Ленина"
2. **Поиск несуществующих улиц**: "НесуществующаяУлица" → пустой результат
3. **Расчет для неизвестного адреса**: 250₽ вместо ошибки
4. **Бесплатная доставка**: От 1200₽ для неизвестных адресов

## Миграция с предыдущей версии

### Что изменилось:
- ❌ **Раньше**: Отказ в доставке для неизвестных адресов
- ✅ **Теперь**: Стандартный тариф 250₽

- ❌ **Раньше**: "Республика Марий Эл, Волжск, улица Ленина"
- ✅ **Теперь**: "Ленина"

### Необходимые изменения в мобильном приложении:
1. Убрать поля ввода города и региона
2. Изменить логику отображения подсказок (использовать `shortAddress`)
3. Обновить обработку ошибок доставки (теперь ошибок нет)
4. Адаптировать UI под новый формат адресов

## Поддержка

При возникновении вопросов по интеграции, обращайтесь к:
- **API документации**: `/api/v1/swagger-ui.html`
- **Тестовым скриптам**: `test_address_suggestions.sh`, `test_comprehensive.sh`
- **Логам приложения**: Все запросы логируются с уровнем INFO