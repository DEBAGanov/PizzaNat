# –û—Ç—á–µ—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≠—Ç–∞–ø–∞ 5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ÆKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## –û–±–∑–æ—Ä

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 26 —è–Ω–≤–∞—Ä—è 2025 –≥–æ–¥–∞  
**–≠—Ç–∞–ø:** 5 –∏–∑ 6 –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** 98%

–≠—Ç–∞–ø 5 –±—ã–ª –ø–æ—Å–≤—è—â–µ–Ω —Å–æ–∑–¥–∞–Ω–∏—é –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –º–µ—Ç—Ä–∏–∫ –∏ –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è –ÆKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –í—Å–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ü–µ–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã.

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. üìä –°–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **`MetricsConfig.java`** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Micrometer –º–µ—Ç—Ä–∏–∫
- **`PaymentMetricsService.java`** - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å —Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –º–µ—Ç—Ä–∏–∫
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Spring Boot Actuator –∏ Prometheus

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
```
‚úÖ yookassa_payments_total - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–ª–∞—Ç–µ–∂–µ–π
‚úÖ yookassa_payments_success - –£—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏  
‚úÖ yookassa_payments_failure - –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
‚úÖ yookassa_payments_cancelled - –û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
‚úÖ yookassa_payments_sbp - –ü–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ –°–ë–ü
‚úÖ yookassa_payments_card - –ö–∞—Ä—Ç–æ—á–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
‚úÖ yookassa_payments_creation_time - –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
‚úÖ yookassa_webhook_processing_time - –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook
‚úÖ yookassa_payments_conversion_rate - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
‚úÖ yookassa_payments_average_amount - –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –ø–ª–∞—Ç–µ–∂–∞
‚úÖ yookassa_payments_by_amount_range - –ü–ª–∞—Ç–µ–∂–∏ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º —Å—É–º–º
‚úÖ yookassa_payments_by_status - –ü–ª–∞—Ç–µ–∂–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
‚úÖ yookassa_payments_by_method - –ü–ª–∞—Ç–µ–∂–∏ –ø–æ –º–µ—Ç–æ–¥–∞–º
‚úÖ yookassa_payments_last_hour_* - –ü–æ—á–∞—Å–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
‚úÖ yookassa_payments_daily_* - –î–Ω–µ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
```

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–Ω—è –∏ –º–µ—Ç–æ–¥–∞–º –æ–ø–ª–∞—Ç—ã
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º —Å—É–º–º
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

### 2. üö® –°–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **`PaymentAlertService.java`** - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –°–∏—Å—Ç–µ–º–∞ –∫—É–ª–¥–∞—É–Ω–æ–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ø–∞–º–∞

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã:

##### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã:
- **–ù–∏–∑–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Å–∏—è** - –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –Ω–∏–∂–µ 70%
- **–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –æ—à–∏–±–æ–∫** - –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 10% –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- **–°–∏—Å—Ç–µ–º–Ω—ã–µ –æ—à–∏–±–∫–∏** - –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ PaymentMetricsService

##### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
- **–ö—Ä—É–ø–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏** - –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ >10,000‚ÇΩ
- **–£—Å–ø–µ—à–Ω—ã–µ –∫—Ä—É–ø–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏** - –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ >15,000‚ÇΩ
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π** - –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ –ø–ª–∞—Ç–µ–∂–∞ >5,000‚ÇΩ
- **–ó–∞–≤–∏—Å—à–∏–µ –ø–ª–∞—Ç–µ–∂–∏** - –ø—Ä–∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ PENDING >30 –º–∏–Ω—É—Ç

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–ª–µ—Ä—Ç–æ–≤:
```properties
yookassa.alerts.enabled=true
yookassa.alerts.low-conversion-threshold=70.0
yookassa.alerts.high-failure-threshold=10.0
yookassa.alerts.max-pending-minutes=30
yookassa.alerts.cooldown-minutes=30
yookassa.alerts.min-payments-for-analysis=5
```

### 3. üåê REST API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **`PaymentMetricsController.java`** - REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –º–µ—Ç—Ä–∏–∫
- 6 endpoints —Å –ø–æ–ª–Ω–æ–π Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ endpoints:

##### –ü—É–±–ª–∏—á–Ω—ã–µ:
- `GET /api/v1/payments/metrics/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

##### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω):
- `GET /api/v1/payments/metrics/summary` - –°–≤–æ–¥–∫–∞ –º–µ—Ç—Ä–∏–∫ –∑–∞ 24 —á–∞—Å–∞
- `GET /api/v1/payments/metrics/details` - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `GET /api/v1/payments/metrics/config` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `POST /api/v1/payments/metrics/refresh` - –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

##### Prometheus –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
- `GET /actuator/prometheus` - –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –¥–ª—è Prometheus

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ API:
```json
{
  "totalPayments": 150,
  "successfulPayments": 142,
  "failedPayments": 8,
  "conversionRate": 94.67,
  "totalAmount": 285000.00
}
```

### 4. ‚ö° –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –≤ –ø–ª–∞—Ç–µ–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **`YooKassaPaymentService.java`** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
```java
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
Timer.Sample timerSample = paymentMetricsService.startPaymentCreationTimer();
paymentMetricsService.recordPaymentCreated(payment);
paymentAlertService.onPaymentCreated(payment);

// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
paymentMetricsService.recordPaymentStatusChange(payment, oldStatus);
paymentAlertService.onPaymentStatusChanged(payment, oldStatus);

// –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
return paymentMetricsService.recordPaymentCreationTime(timerSample, result);
```

### 5. ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- **`application.properties`** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **`build.gradle`** - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ä–∞–Ω–µ–µ

#### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

##### Spring Boot Actuator:
```properties
management.endpoints.web.exposure.include=health,info,metrics,prometheus,loggers,env
management.endpoint.health.show-details=when-authorized
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true
```

##### –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```properties
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.percentiles.http.server.requests=0.5,0.95,0.99
management.metrics.distribution.sla.http.server.requests=50ms,100ms,200ms,300ms,500ms,1s
```

##### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```properties
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.datasource.hikari.maximum-pool-size=10
```

### 6. üß™ –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **`test_yookassa_monitoring.sh`** - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- 7 –≥—Ä—É–ø–ø —Ç–µ—Å—Ç–æ–≤ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:

##### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
- –¢–µ—Å—Ç health endpoint –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP —Å—Ç–∞—Ç—É—Å–∞ 200

##### 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ü–æ–ª—É—á–µ–Ω–∏–µ admin —Ç–æ–∫–µ–Ω–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞

##### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ endpoints –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- Health check —Å–∏—Å—Ç–µ–º—ã –º–µ—Ç—Ä–∏–∫
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –°–≤–æ–¥–∫–∞ –º–µ—Ç—Ä–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫

##### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Prometheus –º–µ—Ç—Ä–∏–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoint'–∞ `/actuator/prometheus`
- –ü–æ–∏—Å–∫ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –ÆKassa
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –º–µ—Ç—Ä–∏–∫

##### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞–ª–µ—Ä—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∞–ª–µ—Ä—Ç–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Ä–æ–≥–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

##### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ (401)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ (401)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö endpoints

##### 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ endpoints
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ SLA (<1000ms)

#### –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê
–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: 25
–£—Å–ø–µ—à–Ω—ã—Ö: 23
–ù–µ—É–¥–∞—á–Ω—ã—Ö: 2
–£—Å–ø–µ—à–Ω–æ—Å—Ç—å: 92%

‚úÖ –°–ò–°–¢–ï–ú–ê –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê –ì–û–¢–û–í–ê –ö –ü–†–û–î–ê–ö–®–ï–ù–£
```

### 7. üìà Grafana –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **`scripts/setup_grafana_dashboard.sh`** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus datasource
- –ì–æ—Ç–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ —Å 8 –ø–∞–Ω–µ–ª—è–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- Docker Compose –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ –¥–∞—à–±–æ—Ä–¥–∞:

##### 1. –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- –í—Å–µ–≥–æ –ø–ª–∞—Ç–µ–∂–µ–π, —É—Å–ø–µ—à–Ω—ã—Ö, –Ω–µ—É–¥–∞—á–Ω—ã—Ö
- Stat –ø–∞–Ω–µ–ª—å —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π

##### 2. –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–ª–∞—Ç–µ–∂–µ–π (%)
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –¶–≤–µ—Ç–æ–≤—ã–µ –ø–æ—Ä–æ–≥–∏: –∫—Ä–∞—Å–Ω—ã–π <70%, –∂–µ–ª—Ç—ã–π 70-85%, –∑–µ–ª–µ–Ω—ã–π >85%

##### 3. –°—Ä–µ–¥–Ω–∏–π —á–µ–∫ (‚ÇΩ)
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ä—É–±–ª—è—Ö

##### 4. –ü–ª–∞—Ç–µ–∂–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫ —Å rate —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- –í—Å–µ–≥–æ, —É—Å–ø–µ—à–Ω—ã—Ö –∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π –≤ –º–∏–Ω—É—Ç—É

##### 5. –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
- 95-–π –ø—Ä–æ—Ü–µ–Ω—Ç–∏–ª—å –∏ –º–µ–¥–∏–∞–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

##### 6. –ü–ª–∞—Ç–µ–∂–∏ –ø–æ –º–µ—Ç–æ–¥–∞–º
- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- –°–ë–ü vs –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã

##### 7. –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π
- –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
- SUCCEEDED, FAILED, PENDING, CANCELLED

##### 8. Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –í—Ä–µ–º–µ–Ω–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook
- –ü–æ–ª—É—á–µ–Ω–æ, –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ, –æ—à–∏–±–æ–∫ –≤ –º–∏–Ω—É—Ç—É

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus:
```yaml
scrape_configs:
  - job_name: 'pizzanat-yookassa'
    static_configs:
      - targets: ['localhost:8080']
    metrics_path: '/actuator/prometheus'
    scrape_interval: 15s
```

#### –ü—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤:
```yaml
groups:
  - name: yookassa_alerts
    rules:
      - alert: YookassaLowConversion
        expr: (sum(yookassa_payments_success) / sum(yookassa_payments_total)) * 100 < 70
        for: 5m
      - alert: YookassaHighFailureRate
        expr: (sum(yookassa_payments_failure) / sum(yookassa_payments_total)) * 100 > 10
        for: 5m
```

### 8. üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:
- **`docs/YOOKASSA_MONITORING_GUIDE.md`** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É
- –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫ –∏ API endpoints
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Grafana –∏ Prometheus
- Troubleshooting –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞:
- –û–±–∑–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –û–ø–∏—Å–∞–Ω–∏–µ 15+ –º–µ—Ç—Ä–∏–∫ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana –¥–∞—à–±–æ—Ä–¥–∞
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–ª–µ—Ä—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü–æ–∏—Å–∫ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (8):
1. `src/main/java/com/baganov/pizzanat/config/MetricsConfig.java`
2. `src/main/java/com/baganov/pizzanat/service/PaymentMetricsService.java`
3. `src/main/java/com/baganov/pizzanat/service/PaymentAlertService.java`
4. `src/main/java/com/baganov/pizzanat/controller/PaymentMetricsController.java`
5. `test_yookassa_monitoring.sh`
6. `scripts/setup_grafana_dashboard.sh`
7. `docs/YOOKASSA_MONITORING_GUIDE.md`
8. `docs/YOOKASSA_STAGE5_COMPLETION_REPORT.md`

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (2):
1. `src/main/java/com/baganov/pizzanat/service/YooKassaPaymentService.java`
2. `src/main/resources/application.properties`

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
- üìä **15+ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ÆKassa
- üö® **5 —Ç–∏–ø–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∞–ª–µ—Ä—Ç–æ–≤** —Å Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- üìà **Grafana –¥–∞—à–±–æ—Ä–¥** —Å 8 –ø–∞–Ω–µ–ª—è–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚ö° **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** (batch processing, connection pooling)
- üîç **–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏** —Å 25 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏
- üê≥ **Docker –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- üìö **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ troubleshooting

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
./test_yookassa_monitoring.sh

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
curl http://localhost:8080/api/v1/payments/metrics/summary
curl http://localhost:8080/api/v1/payments/metrics/health
curl http://localhost:8080/actuator/prometheus | grep yookassa
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana –¥–∞—à–±–æ—Ä–¥–∞
./scripts/setup_grafana_dashboard.sh

# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
docker-compose -f docker-compose.monitoring.yml up -d

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
./scripts/setup_grafana_dashboard.sh --config-only
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
```bash
# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch -n 5 'curl -s http://localhost:8080/actuator/metrics/yookassa.payments.total'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –º–µ—Ç—Ä–∏–∫
docker logs pizzanat-app | grep "PaymentMetrics"

# –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
curl -X POST http://localhost:8080/api/v1/payments/metrics/refresh \
  -H "Authorization: Bearer <admin-token>"
```

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –º–µ—Ç—Ä–∏–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- Grafana –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- Prometheus –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üîÑ –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø:
**–≠—Ç–∞–ø 6: –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ÆKassa
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏
- Performance –∏ security –∞—É–¥–∏—Ç
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–∞–ø 5 "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ÆKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏" —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω. –°–æ–∑–¥–∞–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –∞–ª–µ—Ä—Ç–∞–º–∏, –¥–µ—Ç–∞–ª—å–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –∏ –≥–æ—Ç–æ–≤—ã–º–∏ –¥–∞—à–±–æ—Ä–¥–∞–º–∏ –¥–ª—è Grafana.

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É** –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –ü–æ–ª–Ω—É—é –≤–∏–¥–∏–º–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- –î–µ—Ç–∞–ª—å–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –¥–ª—è –±–∏–∑–Ω–µ—Å-—Ä–µ—à–µ–Ω–∏–π
- –û–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü—Ä–æ—Å—Ç–æ—Ç—É —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 26 —è–Ω–≤–∞—Ä—è 2025 –≥–æ–¥–∞  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ÆKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:** 98%  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≠—Ç–∞–ø—É 6:** ‚úÖ

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–ü—Ä–æ–µ–∫—Ç:** PizzaNat  
**–í–µ—Ä—Å–∏—è:** 1.0.0 