# –û—Ç—á—ë—Ç –æ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üéØ **–¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram Mini App –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏.

## ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

### üê≥ **Docker Environment**
- **‚úÖ PostgreSQL:** –ó–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (port 5432)
- **‚úÖ MinIO S3:** –ó–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (port 9000-9001) 
- **‚úÖ Application:** –ó–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (port 8080)
- **‚úÖ Health Check:** `{"status": "UP"}` - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∑–¥–æ—Ä–æ–≤—ã

### üõ°Ô∏è **Backend API**

#### **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- **‚úÖ GET /actuator/health** - Status: `200 OK`
- **‚úÖ GET /api/v1/categories** - Status: `200 OK`
- **‚úÖ GET /api/v1/products** - Status: `200 OK`

#### **–ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**
- **‚úÖ POST /api/v1/telegram-webapp/auth** - Status: `400` (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)
- **‚úÖ POST /api/v1/telegram-webapp/enhanced-auth** - Status: `400` (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ) 
- **‚úÖ POST /api/v1/telegram-webapp/validate-init-data** - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false` –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### üì± **Mini App Assets**
- **‚úÖ checkout.html** - Status: `200 OK` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ Mini App
- **‚úÖ api.js** - Status: `200 OK` - API –∫–ª–∏–µ–Ω—Ç
- **‚úÖ checkout-app.js** - Status: `200 OK` - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–æ–≤–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- **‚úÖ telegram-web-app.js** - Status: `200 OK` - –ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è 7.7

### üîß **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

#### **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. **‚úÖ Redis –∫–æ–Ω—Ñ–ª–∏–∫—Ç** - RedisConfig –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è dev –ø—Ä–æ—Ñ–∏–ª—è
2. **‚úÖ Cache –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è simple cache –≤–º–µ—Å—Ç–æ Redis
3. **‚úÖ Telegram –±–æ—Ç—ã** - –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (webhook –∫–æ–Ω—Ñ–ª–∏–∫—Ç –Ω–µ –∫—Ä–∏—Ç–∏—á–µ–Ω)
4. **‚úÖ CORS** - –î–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–º–µ–Ω—ã t.me –∏ web.telegram.org

#### **Docker Compose –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- **‚úÖ Telegram –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –≤–∫–ª—é—á–µ–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Mini App
- **‚úÖ JWT —Ç–æ–∫–µ–Ω—ã** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã 
- **‚úÖ CORS** —Ä–∞—Å—à–∏—Ä–µ–Ω –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Telegram

## üß™ **–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**

### ‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
1. **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** - –£—Å–ø–µ—à–Ω–æ –≤ dev —Ä–µ–∂–∏–º–µ
2. **–ë–∞–∑–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è
4. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã** - Mini App —Ñ–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã
5. **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç

### üîÑ **–°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

#### **1. –†–µ–∞–ª—å–Ω—ã–π Telegram —Ç–µ—Å—Ç:**
```bash
# –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º initData
curl -X POST http://localhost:8080/api/v1/telegram-webapp/enhanced-auth \
  -H "Content-Type: application/json" \
  -d '{
    "initDataRaw": "REAL_TELEGRAM_INIT_DATA",
    "phoneNumber": "+79161234567",
    "deviceId": "test-device-123"
  }'
```

#### **2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç–æ–∫–µ–Ω–æ–≤
SELECT * FROM users WHERE telegram_id IS NOT NULL;
SELECT * FROM telegram_auth_tokens WHERE status = 'CONFIRMED';
```

#### **3. –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç:**
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ Mini App
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ –º–æ–±–∏–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏  
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –≤–µ–±-—Å–∞–π—Ç–µ

## üåê **URLs –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

### **–õ–æ–∫–∞–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞:**
- **üè† Health Check:** http://localhost:8080/actuator/health
- **üì± Mini App:** http://localhost:8080/static/miniapp/checkout.html
- **üîß API Test:** http://localhost:8080/static/miniapp/test-api.html
- **üìä MinIO Console:** http://localhost:9001 (accesskey/secretkey)

### **API Endpoints:**
- **üîê Standard Auth:** `POST /api/v1/telegram-webapp/auth`
- **‚ö° Enhanced Auth:** `POST /api/v1/telegram-webapp/enhanced-auth`
- **‚úÖ Validate InitData:** `POST /api/v1/telegram-webapp/validate-init-data`

## ‚ö†Ô∏è **–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**

### **1. Telegram webhook –∫–æ–Ω—Ñ–ª–∏–∫—Ç:**
```
[409] Conflict: can't use getUpdates method while webhook is active
```
**–†–µ—à–µ–Ω–∏–µ:** –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –±–æ—Ç—ã –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å webhook –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### **2. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ `initData` –æ—Ç Telegram WebApp API

## üéâ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ**

### ‚úÖ **–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- **–ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –ë—ç–∫–µ–Ω–¥ –≥–æ—Ç–æ–≤
- **Mini App –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ–±–Ω–æ–≤–ª—ë–Ω
- **API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** - –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **–õ–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞** - Dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### üöÄ **–ì–æ—Ç–æ–≤–æ –∫:**
- **–ü—Ä–æ–¥–∞–∫—à–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é** —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ Telegram –¥–∞–Ω–Ω—ã–º–∏
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–æ–±–∏–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º**  
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏—é –Ω–∞ –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º—É**
- **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é** —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### üìä **–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞:**
- **‚úÖ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:** 100% –¥–æ—Å—Ç—É–ø–Ω—ã
- **‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:** 100% –¥–æ—Å—Ç—É–ø–Ω—ã  
- **‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –ü–æ–¥–∫–ª—é—á–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **‚úÖ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ:** –°—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 27.01.2025  
**–û–∫—Ä—É–∂–µ–Ω–∏–µ:** Docker Compose Dev  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ù**
