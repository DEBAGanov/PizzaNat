# –†–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ Telegram –±–æ—Ç–æ–≤ (–æ—à–∏–±–∫–∞ 409)

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 20.01.2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–ï–®–ï–ù–û  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

## üö® –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –°–∏–º–ø—Ç–æ–º—ã
- –û—à–∏–±–∫–∞ 409 "Conflict: terminated by other getUpdates request" –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –û–¥–∏–Ω –∏–∑ Telegram –±–æ—Ç–æ–≤ –ø–µ—Ä–µ—Å—Ç–∞–≤–∞–ª –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã
- –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞
**–ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ç–æ–∫–µ–Ω–æ–≤**: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `TELEGRAM_BOT_TOKEN` –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∞ –∑–Ω–∞—á–µ–Ω–∏–µ `TELEGRAM_AUTH_BOT_TOKEN`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ç–æ–º—É, —á—Ç–æ –æ–±–∞ –±–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–æ–∫–µ–Ω `7819187384:AAGJNn0cwfJ7Nsv_N25h75eggEmqmD5WZG4`.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞**: Telegram API –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Long Polling –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

## üîß –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker Compose

#### docker-compose.yml (Production)
```yaml
# –î–û (–ø—Ä–æ–±–ª–µ–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):
TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN:-7819187384:AAGJNn0cwfJ7Nsv_N25h75eggEmqmD5WZG4}

# –ü–û–°–õ–ï (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):
TELEGRAM_BOT_TOKEN: ${TELEGRAM_AUTH_BOT_TOKEN:-7819187384:AAGJNn0cwfJ7Nsv_N25h75eggEmqmD5WZG4}
TELEGRAM_ADMIN_BOT_ENABLED: ${TELEGRAM_ADMIN_BOT_ENABLED:-true}  # –í–∫–ª—é—á–µ–Ω –∞–¥–º–∏–Ω—Å–∫–∏–π –±–æ—Ç
```

#### docker-compose.dev.yml (Development)
```yaml
# –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è dev –æ–∫—Ä—É–∂–µ–Ω–∏—è
TELEGRAM_BOT_TOKEN: ${TELEGRAM_AUTH_BOT_TOKEN:-7819187384:AAGJNn0cwfJ7Nsv_N25h75eggEmqmD5WZG4}
TELEGRAM_ADMIN_BOT_ENABLED: ${TELEGRAM_ADMIN_BOT_ENABLED:-true}
```

### 2. –ü–æ–ª–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ Webhook

–í–æ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:
```yaml
TELEGRAM_AUTH_WEBHOOK_ENABLED: false
TELEGRAM_LONGPOLLING_ENABLED: true
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Java –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

#### TelegramAdminBotConfig.java
- –£–ª—É—á—à–µ–Ω–∞ —É—Å–ª–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –±–æ—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞

#### PizzaNatTelegramBot.java
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### PizzaNatAdminBot.java
- –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

#### application.yml
- –î–æ–±–∞–≤–ª–µ–Ω—ã —Å–µ–∫—Ü–∏–∏ `longpolling` –∏ `admin-bot`
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –æ–±–æ–∏—Ö –±–æ—Ç–æ–≤

## üéØ –§–∏–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π –±–æ—Ç–æ–≤

| –ë–æ—Ç | –¢–æ–∫–µ–Ω | Username | –§—É–Ω–∫—Ü–∏–∏ |
|-----|-------|----------|---------|
| **@PizzaNatBot** | `7819187384:AAGJNn0cwfJ7Nsv_N25h75eggEmqmD5WZG4` | PizzaNatBot | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| **@PizzaNatOrders_bot** | `8052456616:AAEoAzBfr3jRpylDmxR-azNBSqimthPCHeg` | PizzaNatOrders_bot | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö |

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```yaml
# –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)
TELEGRAM_BOT_TOKEN: ${TELEGRAM_AUTH_BOT_TOKEN}  # 7819187384:...
TELEGRAM_BOT_USERNAME: PizzaNatBot
TELEGRAM_LONGPOLLING_ENABLED: true

# –ê–¥–º–∏–Ω—Å–∫–∏–π –±–æ—Ç (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)  
TELEGRAM_ADMIN_BOT_TOKEN: 8052456616:AAEoAzBfr3jRpylDmxR-azNBSqimthPCHeg
TELEGRAM_ADMIN_BOT_USERNAME: PizzaNatOrders_bot
TELEGRAM_ADMIN_BOT_ENABLED: true

# Webhook –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–µ–Ω
TELEGRAM_AUTH_WEBHOOK_ENABLED: false
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
–°–æ–∑–¥–∞–Ω `test_telegram_token_conflict_fix.sh` –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker Compose
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ webhook –≤–æ –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
- –í–∫–ª—é—á–µ–Ω–∏–µ Long Polling –¥–ª—è –æ–±–æ–∏—Ö –±–æ—Ç–æ–≤
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –∏ usernames
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ application.yml

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
```bash
chmod +x test_telegram_token_conflict_fix.sh
./test_telegram_token_conflict_fix.sh
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚ùå –û—à–∏–±–∫–∞ 409 –≤ –ª–æ–≥–∞—Ö
- ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ç–æ–∫–µ–Ω–æ–≤
- ‚ùå –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–æ—Ç–æ–≤
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `TELEGRAM_BOT_TOKEN`

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –û—à–∏–±–∫–∞ 409 —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –¢–æ–∫–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
- ‚úÖ –û–±–∞ –±–æ—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- ‚úÖ –¢–æ–ª—å–∫–æ Long Polling, –Ω–∏–∫–∞–∫–∏—Ö webhook –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**:
   ```bash
   docker-compose down && docker-compose up -d
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±–æ—Ç–æ–≤**:
   ```bash
   docker-compose logs -f app | grep -i telegram
   ```

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–æ–≤**:
   - –ö–æ–º–∞–Ω–¥—ã `/start` –≤ @PizzaNatBot
   - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ @PizzaNatOrders_bot

4. **–£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—à–∏–±–∫–∏ 409**:
   ```bash
   docker-compose logs app | grep -i "409\|conflict"
   ```

## üìã –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `docker-compose.yml` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `docker-compose.dev.yml` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ development –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è  
- `src/main/java/com/baganov/pizzanat/config/TelegramAdminBotConfig.java`
- `src/main/java/com/baganov/pizzanat/service/PizzaNatTelegramBot.java`
- `src/main/java/com/baganov/pizzanat/telegram/PizzaNatAdminBot.java`
- `src/main/resources/application.yml`
- `docs/changelog.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å –æ —Ä–µ—à–µ–Ω–∏–∏
- `docs/Tasktracker.md` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
- `test_telegram_token_conflict_fix.sh` - —Å–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞

### –ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ 409?
Telegram Bot API –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö getUpdates –∑–∞–ø—Ä–æ—Å–æ–≤ (Long Polling). –ö–æ–≥–¥–∞ –¥–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—ã—Ç–∞—é—Ç—Å—è –ø–æ–ª—É—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å –æ–¥–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞, –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É 409 Conflict.

### –ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω Long Polling –≤–º–µ—Å—Ç–æ Webhook?
1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL –∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL
2. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –≤–Ω–µ—à–Ω–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
3. **–û—Ç–ª–∞–¥–∫–∞** - –ø—Ä–æ—â–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –∫–∞–∂–¥—ã–π –±–æ—Ç –∏–º–µ–µ—Ç —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: –±–æ—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏ –±–µ–∑ –≤–∑–∞–∏–º–Ω–æ–≥–æ –≤–ª–∏—è–Ω–∏—è
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å**: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ 