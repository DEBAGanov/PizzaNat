<!-- Generated by SpecStory -->

# MinIO Connection Error Troubleshooting (2025-05-18 16:23:01)

_**User**_

2025-05-18 16:33:01 2025-05-18T13:33:01.606Z ERROR 1 --- [PizzaNat] [           main] c.baganov.pizzanat.config.MinioConfig    : Непредвиденная ошибка при инициализации MinIO: Failed to connect to minio/127.0.0.1:9000
2025-05-18 16:33:01 
2025-05-18 16:33:01 java.net.ConnectException: Failed to connect to minio/127.0.0.1:9000
2025-05-18 16:33:01     at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:297) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealConnection.connect(RealConnection.kt:207) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.ExchangeFinder.findConnection(ExchangeFinder.kt:226) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.ExchangeFinder.findHealthyConnection(ExchangeFinder.kt:106) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.ExchangeFinder.find(ExchangeFinder.kt:74) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealCall.initExchange$okhttp(RealCall.kt:255) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.kt:32) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.kt:95) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.kt:83) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.kt:76) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealCall.getResponseWithInterceptorChain$okhttp(RealCall.kt:201) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealCall$AsyncCall.run(RealCall.kt:517) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
2025-05-18 16:33:01     at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
2025-05-18 16:33:01     at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]
2025-05-18 16:33:01 Caused by: java.net.ConnectException: Connection refused
2025-05-18 16:33:01     at java.base/sun.nio.ch.Net.pollConnect(Native Method) ~[na:na]
2025-05-18 16:33:01     at java.base/sun.nio.ch.Net.pollConnectNow(Net.java:672) ~[na:na]
2025-05-18 16:33:01     at java.base/sun.nio.ch.NioSocketImpl.timedFinishConnect(NioSocketImpl.java:542) ~[na:na]
2025-05-18 16:33:01     at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:597) ~[na:na]
2025-05-18 16:33:01     at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327) ~[na:na]
2025-05-18 16:33:01     at java.base/java.net.Socket.connect(Socket.java:633) ~[na:na]
2025-05-18 16:33:01     at okhttp3.internal.platform.Platform.connectSocket(Platform.kt:128) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:295) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     ... 18 common frames omitted
2025-05-18 16:33:01 
2025-05-18 16:33:01 2025-05-18T13:33:01.612Z  WARN 1 --- [PizzaNat] [           main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'adminController' defined in URL [jar:nested:/app/app.jar/!BOOT-INF/classes/!/com/baganov/pizzanat/controller/AdminController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'storageService' defined in URL [jar:nested:/app/app.jar/!BOOT-INF/classes/!/com/baganov/pizzanat/service/StorageService.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'minioClient' defined in class path resource [com/baganov/pizzanat/config/MinioConfig.class]: Failed to instantiate [io.minio.MinioClient]: Factory method 'minioClient' threw exception with message: Ошибка инициализации MinIO клиента
2025-05-18 16:33:01 2025-05-18T13:33:01.613Z  INFO 1 --- [PizzaNat] [           main] j.LocalContainerEntityManagerFactoryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-18 16:33:01 2025-05-18T13:33:01.617Z  INFO 1 --- [PizzaNat] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-05-18 16:33:01 2025-05-18T13:33:01.621Z  INFO 1 --- [PizzaNat] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-05-18 16:33:01 2025-05-18T13:33:01.624Z  INFO 1 --- [PizzaNat] [           main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-05-18 16:33:01 2025-05-18T13:33:01.640Z  INFO 1 --- [PizzaNat] [           main] .s.b.a.l.ConditionEvaluationReportLogger : 
2025-05-18 16:33:01 
2025-05-18 16:33:01 Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-05-18 16:33:01 2025-05-18T13:33:01.655Z ERROR 1 --- [PizzaNat] [           main] o.s.boot.SpringApplication               : Application run failed
2025-05-18 16:33:01 
2025-05-18 16:33:01 org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'adminController' defined in URL [jar:nested:/app/app.jar/!BOOT-INF/classes/!/com/baganov/pizzanat/controller/AdminController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'storageService' defined in URL [jar:nested:/app/app.jar/!BOOT-INF/classes/!/com/baganov/pizzanat/service/StorageService.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'minioClient' defined in class path resource [com/baganov/pizzanat/config/MinioConfig.class]: Failed to instantiate [io.minio.MinioClient]: Factory method 'minioClient' threw exception with message: Ошибка инициализации MinIO клиента
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:804) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1387) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1224) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:371) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultListableBeanFactory.instantiateSingleton(DefaultListableBeanFactory.java:1221) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingleton(DefaultListableBeanFactory.java:1187) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:1122) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:987) ~[spring-context-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:627) ~[spring-context-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146) ~[spring-boot-3.4.5.jar!/:3.4.5]
2025-05-18 16:33:01     at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:753) ~[spring-boot-3.4.5.jar!/:3.4.5]
2025-05-18 16:33:01     at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:439) ~[spring-boot-3.4.5.jar!/:3.4.5]
2025-05-18 16:33:01     at org.springframework.boot.SpringApplication.run(SpringApplication.java:318) ~[spring-boot-3.4.5.jar!/:3.4.5]
2025-05-18 16:33:01     at org.springframework.boot.SpringApplication.run(SpringApplication.java:1362) ~[spring-boot-3.4.5.jar!/:3.4.5]
2025-05-18 16:33:01     at org.springframework.boot.SpringApplication.run(SpringApplication.java:1351) ~[spring-boot-3.4.5.jar!/:3.4.5]
2025-05-18 16:33:01     at com.baganov.pizzanat.PizzaNatApplication.main(PizzaNatApplication.java:14) ~[!/:0.0.1-SNAPSHOT]
2025-05-18 16:33:01     at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
2025-05-18 16:33:01     at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
2025-05-18 16:33:01     at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
2025-05-18 16:33:01     at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
2025-05-18 16:33:01     at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:102) ~[app.jar:0.0.1-SNAPSHOT]
2025-05-18 16:33:01     at org.springframework.boot.loader.launch.Launcher.launch(Launcher.java:64) ~[app.jar:0.0.1-SNAPSHOT]
2025-05-18 16:33:01     at org.springframework.boot.loader.launch.JarLauncher.main(JarLauncher.java:40) ~[app.jar:0.0.1-SNAPSHOT]
2025-05-18 16:33:01 Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'storageService' defined in URL [jar:nested:/app/app.jar/!BOOT-INF/classes/!/com/baganov/pizzanat/service/StorageService.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'minioClient' defined in class path resource [com/baganov/pizzanat/config/MinioConfig.class]: Failed to instantiate [io.minio.MinioClient]: Factory method 'minioClient' threw exception with message: Ошибка инициализации MinIO клиента
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:804) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.autowireConstructor(ConstructorResolver.java:240) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.autowireConstructor(AbstractAutowireCapableBeanFactory.java:1387) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1224) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:371) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1681) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1627) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:913) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     ... 28 common frames omitted
2025-05-18 16:33:01 Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'minioClient' defined in class path resource [com/baganov/pizzanat/config/MinioConfig.class]: Failed to instantiate [io.minio.MinioClient]: Factory method 'minioClient' threw exception with message: Ошибка инициализации MinIO клиента
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:657) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.instantiateUsingFactoryMethod(ConstructorResolver.java:489) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.instantiateUsingFactoryMethod(AbstractAutowireCapableBeanFactory.java:1367) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1197) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:569) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:529) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:339) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:371) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:337) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:202) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1681) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1627) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.resolveAutowiredArgument(ConstructorResolver.java:913) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.createArgumentArray(ConstructorResolver.java:791) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     ... 41 common frames omitted
2025-05-18 16:33:01 Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [io.minio.MinioClient]: Factory method 'minioClient' threw exception with message: Ошибка инициализации MinIO клиента
2025-05-18 16:33:01     at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:199) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiateWithFactoryMethod(SimpleInstantiationStrategy.java:88) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.SimpleInstantiationStrategy.instantiate(SimpleInstantiationStrategy.java:168) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.ConstructorResolver.instantiate(ConstructorResolver.java:653) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     ... 54 common frames omitted
2025-05-18 16:33:01 Caused by: java.lang.RuntimeException: Ошибка инициализации MinIO клиента
2025-05-18 16:33:01     at com.baganov.pizzanat.config.MinioConfig.minioClient(MinioConfig.java:75) ~[!/:0.0.1-SNAPSHOT]
2025-05-18 16:33:01     at com.baganov.pizzanat.config.MinioConfig$$SpringCGLIB$$0.CGLIB$minioClient$0(<generated>) ~[!/:0.0.1-SNAPSHOT]
2025-05-18 16:33:01     at com.baganov.pizzanat.config.MinioConfig$$SpringCGLIB$$FastClass$$1.invoke(<generated>) ~[!/:0.0.1-SNAPSHOT]
2025-05-18 16:33:01     at org.springframework.cglib.proxy.MethodProxy.invokeSuper(MethodProxy.java:258) ~[spring-core-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.context.annotation.ConfigurationClassEnhancer$BeanMethodInterceptor.intercept(ConfigurationClassEnhancer.java:393) ~[spring-context-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at com.baganov.pizzanat.config.MinioConfig$$SpringCGLIB$$0.minioClient(<generated>) ~[!/:0.0.1-SNAPSHOT]
2025-05-18 16:33:01     at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
2025-05-18 16:33:01     at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
2025-05-18 16:33:01     at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
2025-05-18 16:33:01     at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
2025-05-18 16:33:01     at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:359) ~[spring-aop-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196) ~[spring-aop-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) ~[spring-aop-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.retry.annotation.AnnotationAwareRetryOperationsInterceptor.invoke(AnnotationAwareRetryOperationsInterceptor.java:165) ~[spring-retry-2.0.11.jar!/:na]
2025-05-18 16:33:01     at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184) ~[spring-aop-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:728) ~[spring-aop-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     at com.baganov.pizzanat.config.MinioConfig$$SpringCGLIB$$1.minioClient(<generated>) ~[!/:0.0.1-SNAPSHOT]
2025-05-18 16:33:01     at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
2025-05-18 16:33:01     at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
2025-05-18 16:33:01     at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
2025-05-18 16:33:01     at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
2025-05-18 16:33:01     at org.springframework.beans.factory.support.SimpleInstantiationStrategy.lambda$instantiate$0(SimpleInstantiationStrategy.java:171) ~[spring-beans-6.2.6.jar!/:6.2.6]
2025-05-18 16:33:01     ... 57 common frames omitted
2025-05-18 16:33:01 Caused by: java.net.ConnectException: Failed to connect to minio/127.0.0.1:9000
2025-05-18 16:33:01     at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:297) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealConnection.connect(RealConnection.kt:207) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.ExchangeFinder.findConnection(ExchangeFinder.kt:226) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.ExchangeFinder.findHealthyConnection(ExchangeFinder.kt:106) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.ExchangeFinder.find(ExchangeFinder.kt:74) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealCall.initExchange$okhttp(RealCall.kt:255) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.kt:32) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.kt:95) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.kt:83) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.kt:76) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealCall.getResponseWithInterceptorChain$okhttp(RealCall.kt:201) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealCall$AsyncCall.run(RealCall.kt:517) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[na:na]
2025-05-18 16:33:01     at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[na:na]
2025-05-18 16:33:01     at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]
2025-05-18 16:33:01 Caused by: java.net.ConnectException: Connection refused
2025-05-18 16:33:01     at java.base/sun.nio.ch.Net.pollConnect(Native Method) ~[na:na]
2025-05-18 16:33:01     at java.base/sun.nio.ch.Net.pollConnectNow(Net.java:672) ~[na:na]
2025-05-18 16:33:01     at java.base/sun.nio.ch.NioSocketImpl.timedFinishConnect(NioSocketImpl.java:542) ~[na:na]
2025-05-18 16:33:01     at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:597) ~[na:na]
2025-05-18 16:33:01     at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327) ~[na:na]
2025-05-18 16:33:01     at java.base/java.net.Socket.connect(Socket.java:633) ~[na:na]
2025-05-18 16:33:01     at okhttp3.internal.platform.Platform.connectSocket(Platform.kt:128) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     at okhttp3.internal.connection.RealConnection.connectSocket(RealConnection.kt:295) ~[okhttp-4.12.0.jar!/:na]
2025-05-18 16:33:01     ... 18 common frames omitted
2025-05-18 16:33:01 


---

_**Assistant**_

Ошибка, которую вы видите, означает, что ваше Spring Boot приложение не может подключиться к серверу MinIO по адресу 127.0.0.1:9000. Вот как это исправить:

### Причина ошибки

- MinIO не запущен на `localhost:9000`
- Неправильные настройки подключения (host, port, credentials)
- MinIO стартует позже, чем приложение (актуально для Docker Compose)
- MinIO слушает другой адрес/порт

---

### Как исправить

#### 1. Проверьте, запущен ли MinIO

Откройте терминал и выполните:
```sh
lsof -i :9000
```
или
```sh
netstat -an | grep 9000
```
Если порт не слушается — MinIO не запущен.

#### 2. Запустите MinIO

**Локально:**
```sh
minio server /data --console-address ":9001"
```
(или используйте ваш путь к данным)

**Через Docker:**
```sh
docker run -p 9000:9000 -p 9001:9001 \
  -e "MINIO_ROOT_USER=minioadmin" \
  -e "MINIO_ROOT_PASSWORD=minioadmin" \
  quay.io/minio/minio server /data --console-address ":9001"
```

#### 3. Проверьте настройки подключения

В `application.properties` или `application.yml` должны быть корректные параметры:
```properties
minio.url=http://127.0.0.1:9000
minio.access-key=minioadmin
minio.secret-key=minioadmin
```
или
```yaml
minio:
  url: http://127.0.0.1:9000
  access-key: minioadmin
  secret-key: minioadmin
```
**Важно:** Если MinIO работает в Docker, а приложение — на хосте, используйте `localhost`. Если оба в Docker, используйте имя сервиса из `docker-compose.yml`.

#### 4. Проверьте класс конфигурации MinioConfig

Убедитесь, что MinioClient создаётся правильно и не падает при ошибке подключения (лучше не делать connect в конструкторе, а только инициализацию клиента).

#### 5. Логи MinIO

Проверьте логи MinIO — нет ли ошибок запуска.

---

### Пример docker-compose

```yaml
version: '3.7'
services:
  minio:
    image: quay.io/minio/minio
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
```

---

### Резюме

1. Запустите MinIO на 127.0.0.1:9000
2. Проверьте настройки подключения в приложении
3. Перезапустите приложение

Если после этого ошибка останется — покажите содержимое вашего `MinioConfig` и настроек, помогу точечно.

Если нужно — могу дать пример корректного класса конфигурации MinioConfig для Spring Boot.

---

_**User**_

@MinioConfig.java  содержимое вашего MinioConfig

---

_**Assistant**_

Ваш класс `MinioConfig` реализован современно и с учетом лучших практик, но есть несколько важных моментов и рекомендаций:

---

### 1. Причина ошибки

Ошибка подключения возникает потому, что MinIO не запущен или недоступен по адресу, указанному в `${s3.endpoint}` (например, `http://127.0.0.1:9000`).  
Ваша конфигурация корректно выбрасывает исключение, если не удаётся подключиться.

---

### 2. Проблема с запуском MinIO через Docker

Ваша ошибка:
```
Unable to find image 'quay.io/minio/minio:latest' locally
docker: Error response from daemon: Head "https://quay.io/v2/minio/minio/manifests/latest": ...
```
Это значит, что Docker не может скачать образ MinIO из quay.io.  
Возможные причины:
- Нет интернета или проблемы с DNS
- quay.io временно недоступен
- Блокировка на уровне сети

**Решение:**  
Попробуйте использовать официальный Docker Hub:
```sh
docker run -p 9000:9000 -p 9001:9001 \
  -e "MINIO_ROOT_USER=minioadmin" \
  -e "MINIO_ROOT_PASSWORD=minioadmin" \
  minio/minio server /data --console-address ":9001"
```
или используйте другой источник образа.

---

### 3. Проверка переменных окружения

Убедитесь, что в вашем `application.properties` или `application.yml` прописаны корректные значения:
```properties
s3.endpoint=http://127.0.0.1:9000
s3.access-key=minioadmin
s3.secret-key=minioadmin
s3.bucket=pizzanat
```
**Важно:** Если приложение и MinIO работают в Docker, используйте имя сервиса, например:  
`s3.endpoint=http://minio:9000`

---

### 4. Рекомендации по коду

- Не инициализируйте бакет в методе создания бина. Лучше вынести инициализацию в отдельный сервис, чтобы не блокировать старт приложения, если MinIO временно недоступен.
- Используйте аннотацию `@PostConstruct` для инициализации бакета после создания бина, если хотите отделить создание клиента и инициализацию бакета.

---

### 5. Пример улучшенного MinioConfig

```java
@Slf4j
@Configuration
@RequiredArgsConstructor
public class MinioConfig {

    @Value("${s3.endpoint}")
    private String endpoint;

    @Value("${s3.access-key}")
    private String accessKey;

    @Value("${s3.secret-key}")
    private String secretKey;

    @Value("${s3.bucket}")
    private String bucket;

    @Bean
    public MinioClient minioClient() {
        return MinioClient.builder()
                .endpoint(endpoint)
                .credentials(accessKey, secretKey)
                .build();
    }
}
```
**Инициализация бакета — в отдельном сервисе:**
```java
@Service
@RequiredArgsConstructor
public class MinioBucketInitializer {

    private final MinioClient minioClient;
    @Value("${s3.bucket}")
    private String bucket;

    @PostConstruct
    public void init() {
        try {
            boolean exists = minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucket).build());
            if (!exists) {
                minioClient.makeBucket(MakeBucketArgs.builder().bucket(bucket).build());
                log.info("Бакет '{}' успешно создан", bucket);
            }
        } catch (Exception e) {
            log.error("Ошибка инициализации бакета MinIO: {}", e.getMessage(), e);
        }
    }
}
```
---

### Итог

- Запустите MinIO (лучше через Docker Hub)
- Проверьте настройки подключения
- Разделите создание клиента и инициализацию бакета для лучшей устойчивости приложения

Если после этого останутся вопросы — напишите, помогу точечно!

---

