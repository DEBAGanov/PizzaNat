<!-- Generated by SpecStory -->

# Проблемы с получением JWT токена (2025-05-18 14:10:41)

_**User**_

Мне не выдается JWT токен  при тестировании через curl 

---

_**Assistant**_

Давайте проверим работу аутентификации и выясним причину проблемы с получением JWT токена.

Сначала я проверю логи приложения, чтобы увидеть, что происходит при попытке аутентификации:

---



---

Давайте проверим состояние приложения:

---

```bash
curl http://localhost:8080/debug/status
```

```
curl: (7) Failed to connect to localhost port 8080 after 0 ms: Couldn't connect
to server

```

---

Похоже, что приложение не запущено. Давайте запустим его:

---

```bash
./gradlew bootRun
```

```


> Task :compileJava
/Users/a123/IdeaProjects/PizzaNat/src/main/java/com/baganov/pizzanat/model/entity/Cart.java:40: warning: @Bu
ilder will ignore the initializing expression entirely. If you want the initializing expression to serve as
default, add @Builder.Default. If it is not supposed to be settable during building, make the field final.
    private List<CartItem> items = new ArrayList<>();
                           ^
/Users/a123/IdeaProjects/PizzaNat/src/main/java/com/baganov/pizzanat/model/entity/Role.java:35: warning: @Bu
ilder will ignore the initializing expression entirely. If you want the initializing expression to serve as
default, add @Builder.Default. If it is not supposed to be settable during building, make the field final.
    private Set<User> users = new HashSet<>();
                      ^
/Users/a123/IdeaProjects/PizzaNat/src/main/java/com/baganov/pizzanat/model/entity/User.java:58: warning: @Bu
ilder will ignore the initializing expression entirely. If you want the initializing expression to serve as
default, add @Builder.Default. If it is not supposed to be settable during building, make the field final.
    private Set<Role> roles = new HashSet<>();
                      ^
/Users/a123/IdeaProjects/PizzaNat/src/main/java/com/baganov/pizzanat/model/entity/DeliveryLocation.java:53: 
warning: @Builder will ignore the initializing expression entirely. If you want the initializing expression
to serve as default, add @Builder.Default. If it is not supposed to be settable during building, make the fi
eld final.
    private List<Order> orders = new ArrayList<>();
                        ^
/Users/a123/IdeaProjects/PizzaNat/src/main/java/com/baganov/pizzanat/model/entity/Category.java:47: warning:
 @Builder will ignore the initializing expression entirely. If you want the initializing expression to serve
 as default, add @Builder.Default. If it is not supposed to be settable during building, make the field fina
l.
    private List<Product> products = new ArrayList<>();
                          ^
/Users/a123/IdeaProjects/PizzaNat/src/main/java/com/baganov/pizzanat/model/entity/Order.java:57: warning: @B
uilder will ignore the initializing expression entirely. If you want the initializing expression to serve as
 default, add @Builder.Default. If it is not supposed to be settable during building, make the field final.
    private List<OrderItem> items = new ArrayList<>();
                            ^
6 warnings

> Task :bootRun

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v3.4.5)

2025-05-18T17:08:15.493+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.PizzaNatApplic
ation   : Starting PizzaNatApplication using Java 17.0.13 with PID 76371 (/Users/a123/IdeaProjects/PizzaNat/
build/classes/java/main started by a123 in /Users/a123/IdeaProjects/PizzaNat)
2025-05-18T17:08:15.497+03:00 DEBUG 76371 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.PizzaNatApplic
ation   : Running with Spring Boot v3.4.5, Spring v6.2.6
2025-05-18T17:08:15.498+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.PizzaNatApplic
ation   : No active profile set, falling back to 1 default profile: "default"
2025-05-18T17:08:15.611+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .s.b.d.c.l.DockerComposeLifecycle
Manager : Using Docker Compose file /Users/a123/IdeaProjects/PizzaNat/compose.yaml
2025-05-18T17:08:17.304+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   : time="2025-05-18T17:08:17+03:00" level=warning msg="/Users/a123/IdeaProjects/PizzaNat/compose.yaml
: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
2025-05-18T17:08:17.379+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Network pizzanat_default  Creating
2025-05-18T17:08:17.525+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Network pizzanat_default  Created
2025-05-18T17:08:17.564+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio  Creating
2025-05-18T17:08:17.565+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-postgres  Creating
2025-05-18T17:08:17.566+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-redis  Creating
2025-05-18T17:08:17.778+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio  Created
2025-05-18T17:08:17.778+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio-init  Creating
2025-05-18T17:08:17.780+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-redis  Created
2025-05-18T17:08:17.807+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-postgres  Created
2025-05-18T17:08:18.343+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio-init  Created
2025-05-18T17:08:18.396+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio  Starting
2025-05-18T17:08:18.396+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-postgres  Starting
2025-05-18T17:08:18.396+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-redis  Starting
2025-05-18T17:08:20.954+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio  Started
2025-05-18T17:08:20.991+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio-init  Starting
2025-05-18T17:08:21.172+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-redis  Started
2025-05-18T17:08:21.197+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-postgres  Started
2025-05-18T17:08:22.282+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio-init  Started
2025-05-18T17:08:22.283+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-postgres  Waiting
2025-05-18T17:08:22.283+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-redis  Waiting
2025-05-18T17:08:22.284+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio  Waiting
2025-05-18T17:08:22.284+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio-init  Waiting
2025-05-18T17:08:22.802+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio-init  Healthy
2025-05-18T17:08:31.288+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-redis  Healthy
2025-05-18T17:08:31.289+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-postgres  Healthy
2025-05-18T17:08:51.323+03:00  INFO 76371 --- [PizzaNat] [utReader-stderr] o.s.boot.docker.compose.core.Dock
erCli   :  Container pizzanat-minio  Healthy
2025-05-18T17:08:52.480+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .e.DevToolsPropertyDefaultsPostPr
ocessor : Devtools property defaults active! Set 'spring.devtools.add-properties' to 'false' to disable
2025-05-18T17:08:52.480+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .e.DevToolsPropertyDefaultsPostPr
ocessor : For additional web related logging consider setting the 'logging.level.web' property to 'DEBUG'
2025-05-18T17:08:53.768+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .s.d.r.c.RepositoryConfigurationD
elegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-18T17:08:53.770+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .s.d.r.c.RepositoryConfigurationD
elegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-05-18T17:08:53.909+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .s.d.r.c.RepositoryConfigurationD
elegate : Finished Spring Data repository scanning in 132 ms. Found 8 JPA repository interfaces.
2025-05-18T17:08:53.930+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .s.d.r.c.RepositoryConfigurationD
elegate : Multiple Spring Data modules found, entering strict repository configuration mode
2025-05-18T17:08:53.931+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .s.d.r.c.RepositoryConfigurationD
elegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-05-18T17:08:53.943+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .RepositoryConfigurationExtension
Support : Spring Data Redis - Could not safely identify store assignment for repository candidate interface
com.baganov.pizzanat.repository.CartRepository; If you want this repository to be a Redis repository, consid
er annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (pr
eferred), or consider extending one of the following types with your repository: org.springframework.data.ke
yvalue.repository.KeyValueRepository
2025-05-18T17:08:53.944+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .RepositoryConfigurationExtension
Support : Spring Data Redis - Could not safely identify store assignment for repository candidate interface
com.baganov.pizzanat.repository.CategoryRepository; If you want this repository to be a Redis repository, co
nsider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash
 (preferred), or consider extending one of the following types with your repository: org.springframework.dat
a.keyvalue.repository.KeyValueRepository
2025-05-18T17:08:53.944+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .RepositoryConfigurationExtension
Support : Spring Data Redis - Could not safely identify store assignment for repository candidate interface
com.baganov.pizzanat.repository.DeliveryLocationRepository; If you want this repository to be a Redis reposi
tory, consider annotating your entities with one of these annotations: org.springframework.data.redis.core.R
edisHash (preferred), or consider extending one of the following types with your repository: org.springframe
work.data.keyvalue.repository.KeyValueRepository
2025-05-18T17:08:53.944+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .RepositoryConfigurationExtension
Support : Spring Data Redis - Could not safely identify store assignment for repository candidate interface
com.baganov.pizzanat.repository.OrderRepository; If you want this repository to be a Redis repository, consi
der annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (p
referred), or consider extending one of the following types with your repository: org.springframework.data.k
eyvalue.repository.KeyValueRepository
2025-05-18T17:08:53.944+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .RepositoryConfigurationExtension
Support : Spring Data Redis - Could not safely identify store assignment for repository candidate interface
com.baganov.pizzanat.repository.OrderStatusRepository; If you want this repository to be a Redis repository,
 consider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisH
ash (preferred), or consider extending one of the following types with your repository: org.springframework.
data.keyvalue.repository.KeyValueRepository
2025-05-18T17:08:53.945+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .RepositoryConfigurationExtension
Support : Spring Data Redis - Could not safely identify store assignment for repository candidate interface
com.baganov.pizzanat.repository.ProductRepository; If you want this repository to be a Redis repository, con
sider annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash
(preferred), or consider extending one of the following types with your repository: org.springframework.data
.keyvalue.repository.KeyValueRepository
2025-05-18T17:08:53.945+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .RepositoryConfigurationExtension
Support : Spring Data Redis - Could not safely identify store assignment for repository candidate interface
com.baganov.pizzanat.repository.RoleRepository; If you want this repository to be a Redis repository, consid
er annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (pr
eferred), or consider extending one of the following types with your repository: org.springframework.data.ke
yvalue.repository.KeyValueRepository
2025-05-18T17:08:53.945+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .RepositoryConfigurationExtension
Support : Spring Data Redis - Could not safely identify store assignment for repository candidate interface
com.baganov.pizzanat.repository.UserRepository; If you want this repository to be a Redis repository, consid
er annotating your entities with one of these annotations: org.springframework.data.redis.core.RedisHash (pr
eferred), or consider extending one of the following types with your repository: org.springframework.data.ke
yvalue.repository.KeyValueRepository
2025-05-18T17:08:53.945+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .s.d.r.c.RepositoryConfigurationD
elegate : Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-05-18T17:08:56.015+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWeb
Server  : Tomcat initialized with port 8080 (http)
2025-05-18T17:08:56.053+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.apache.catalina.core.StandardSe
rvice   : Starting service [Tomcat]
2025-05-18T17:08:56.054+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.apache.catalina.core.StandardEn
gine    : Starting Servlet engine: [Apache Tomcat/10.1.40]
2025-05-18T17:08:56.170+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.a.c.c.C.[Tomcat].[localhost].[/
]       : Initializing Spring embedded WebApplicationContext
2025-05-18T17:08:56.173+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] w.s.c.ServletWebServerApplication
Context : Root WebApplicationContext: initialization completed in 3689 ms
2025-05-18T17:08:56.497+03:00 DEBUG 76371 --- [PizzaNat] [  restartedMain] c.b.p.security.JwtAuthenticationF
ilter   : Filter 'jwtAuthenticationFilter' configured for use
2025-05-18T17:08:57.060+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] org.flywaydb.core.FlywayExecutor 
        : Database: jdbc:postgresql://127.0.0.1:5432/pizzanat_db (PostgreSQL 15.13)
2025-05-18T17:08:57.253+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.f.core.internal.command.DbValid
ate     : Successfully validated 6 migrations (execution time 00:00.093s)
2025-05-18T17:08:57.438+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.f.core.internal.command.DbMigra
te      : Current version of schema "public": 6
2025-05-18T17:08:57.439+03:00  WARN 76371 --- [PizzaNat] [  restartedMain] o.f.core.internal.command.DbMigra
te      : outOfOrder mode is active. Migration of schema "public" may not be reproducible.
2025-05-18T17:08:57.447+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.f.core.internal.command.DbMigra
te      : Schema "public" is up to date. No migration necessary.
2025-05-18T17:08:57.634+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.hibernate.jpa.internal.util.Log
Helper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2025-05-18T17:08:57.754+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] org.hibernate.Version

        : HHH000412: Hibernate ORM core version 6.6.13.Final
2025-05-18T17:08:57.807+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.h.c.internal.RegionFactoryIniti
ator    : HHH000026: Second-level cache disabled
2025-05-18T17:08:58.475+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.s.o.j.p.SpringPersistenceUnitIn
fo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-05-18T17:08:58.602+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] com.zaxxer.hikari.HikariDataSourc
e       : HikariPool-1 - Starting...
2025-05-18T17:08:58.726+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] com.zaxxer.hikari.pool.HikariPool
        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@7d7f715b
2025-05-18T17:08:58.737+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] com.zaxxer.hikari.HikariDataSourc
e       : HikariPool-1 - Start completed.
2025-05-18T17:08:59.027+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] org.hibernate.orm.connections.poo
ling    : HHH10001005: Database info:
        Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
        Database driver: undefined/unknown
        Database version: 15.13
        Autocommit mode: undefined/unknown
        Isolation level: undefined/unknown
        Minimum pool size: undefined/unknown
        Maximum pool size: undefined/unknown
2025-05-18T17:09:01.072+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.h.e.t.j.p.i.JtaPlatformInitiato
r       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platf
orm integration)
2025-05-18T17:09:02.176+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] j.LocalContainerEntityManagerFact
oryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-18T17:09:02.564+03:00  WARN 76371 --- [PizzaNat] [  restartedMain] o.s.aop.framework.CglibAopProxy

        : Unable to proxy interface-implementing method [public final void org.springframework.web.filter.On
cePerRequestFilter.doFilter(jakarta.servlet.ServletRequest,jakarta.servlet.ServletResponse,jakarta.servlet.F
ilterChain) throws jakarta.servlet.ServletException,java.io.IOException] because it is marked as final, cons
ider using interface-based JDK proxies instead.
2025-05-18T17:09:02.565+03:00  WARN 76371 --- [PizzaNat] [  restartedMain] o.s.aop.framework.CglibAopProxy

        : Unable to proxy interface-implementing method [public final void org.springframework.web.filter.Ge
nericFilterBean.init(jakarta.servlet.FilterConfig) throws jakarta.servlet.ServletException] because it is ma
rked as final, consider using interface-based JDK proxies instead.
2025-05-18T17:09:02.588+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.config.MinioCo
nfig    : Инициализация MinIO клиента с параметрами: endpoint=http://localhost:9000, bucket=pizzanat
2025-05-18T17:09:03.306+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.config.MinioCo
nfig    : Бакет 'pizzanat' уже существует
2025-05-18T17:09:03.597+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] eAuthenticationProviderManagerCon
figurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationP
rovider
2025-05-18T17:09:03.597+03:00  WARN 76371 --- [PizzaNat] [  restartedMain] r$InitializeUserDetailsManagerCon
figurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService be
ans will not be used by Spring Security for automatically configuring username/password login. Consider remo
ving the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually ins
tantiated DaoAuthenticationProvider. If the current configuration is intentional, to turn off this warning,
increase the logging level of 'org.springframework.security.config.annotation.authentication.configuration.I
nitializeUserDetailsBeanManagerConfigurer' to ERROR
2025-05-18T17:09:03.628+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.s.d.j.r.query.QueryEnhancerFact
ory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2025-05-18T17:09:07.160+03:00 DEBUG 76371 --- [PizzaNat] [  restartedMain] s.w.s.m.m.a.RequestMappingHandler
Mapping : 32 mappings in 'requestMappingHandlerMapping'
2025-05-18T17:09:07.307+03:00 DEBUG 76371 --- [PizzaNat] [  restartedMain] o.s.w.s.handler.SimpleUrlHandlerM
apping  : Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHan
dlerMapping'
2025-05-18T17:09:07.326+03:00 DEBUG 76371 --- [PizzaNat] [  restartedMain] c.b.pizzanat.config.SecurityConfi
g       : Configuring security with public URLs: [/api/v1/auth/**, /api/v1/products/**, /api/v1/categories/*
*, /api/v1/delivery/locations, /v3/api-docs/**, /swagger-ui/**, /swagger-ui.html, /webjars/**, /, /debug/**]
2025-05-18T17:09:07.326+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] c.b.pizzanat.config.SecurityConfi
g       : Режим без проверки JWT: false
2025-05-18T17:09:07.396+03:00 DEBUG 76371 --- [PizzaNat] [  restartedMain] o.s.s.web.DefaultSecurityFilterCh
ain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, Se
curityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, JwtAuthenticationFilter$$SpringCGLI
B$$0, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, Sessi
onManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-05-18T17:09:07.522+03:00 DEBUG 76371 --- [PizzaNat] [  restartedMain] s.w.s.m.m.a.RequestMappingHandler
Adapter : ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvic
e
2025-05-18T17:09:07.582+03:00 DEBUG 76371 --- [PizzaNat] [  restartedMain] .m.m.a.ExceptionHandlerExceptionR
esolver : ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-05-18T17:09:07.938+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.s.b.d.a.OptionalLiveReloadServe
r       : LiveReload server is running on port 35729
2025-05-18T17:09:08.083+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWeb
Server  : Tomcat started on port 8080 (http) with context path '/'
2025-05-18T17:09:08.113+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.PizzaNatApplic
ation   : Started PizzaNatApplication in 53.239 seconds (process running for 54.36)
Hibernate: 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.is_active,
        u1_0.last_name,
        u1_0.password,
        u1_0.phone,
        u1_0.updated_at,
        u1_0.username 
    from
        users u1_0 
    where
        u1_0.username=?
Hibernate: 
    select
        r1_0.user_id,
        r1_1.id,
        r1_1.created_at,
        r1_1.name,
        r1_1.updated_at 
    from
        user_roles r1_0 
    join
        roles r1_1 
            on r1_1.id=r1_0.role_id 
    where
        r1_0.user_id=?
Hibernate: 
    select
        u1_0.role_id,
        u1_1.id,
        u1_1.created_at,
        u1_1.email,
        u1_1.first_name,
        u1_1.is_active,
        u1_1.last_name,
        u1_1.password,
        u1_1.phone,
        u1_1.updated_at,
        u1_1.username 
    from
        user_roles u1_0 
    join
        users u1_1 
            on u1_1.id=u1_0.user_id 
    where
        u1_0.role_id=?
Hibernate: 
    select
        r1_0.user_id,
        r1_1.id,
        r1_1.created_at,
        r1_1.name,
        r1_1.updated_at 
    from
        user_roles r1_0 
    join
        roles r1_1 
            on r1_1.id=r1_0.role_id 
    where
        r1_0.user_id=?
2025-05-18T17:09:08.509+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] .s.b.a.l.ConditionEvaluationRepor
tLogger :

Error starting ApplicationContext. To display the condition evaluation report re-run your application with '
debug' enabled.
2025-05-18T17:09:08.538+03:00 ERROR 76371 --- [PizzaNat] [  restartedMain] o.s.boot.SpringApplication

        : Application run failed

java.util.ConcurrentModificationException: null
        at java.base/java.util.ArrayList$Itr.checkForComodification(ArrayList.java:1013) ~[na:na]
        at java.base/java.util.ArrayList$Itr.next(ArrayList.java:967) ~[na:na]
        at java.base/java.util.AbstractCollection.addAll(AbstractCollection.java:335) ~[na:na]
        at org.hibernate.collection.spi.PersistentSet.injectLoadedState(PersistentSet.java:311) ~[hibernate-
core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.results.internal.LoadingCollectionEntryImpl.finishLoading(LoadingCollectionEntr
yImpl.java:78) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.results.jdbc.internal.JdbcValuesSourceProcessingStateStandardImpl.finishLoading
Collections(JdbcValuesSourceProcessingStateStandardImpl.java:171) ~[hibernate-core-6.6.13.Final.jar:6.6.13.F
inal]
        at org.hibernate.sql.results.jdbc.internal.JdbcValuesSourceProcessingStateStandardImpl.finishUp(Jdbc
ValuesSourceProcessingStateStandardImpl.java:142) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:205) ~[hiberna
te-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:35) ~[hibernat
e-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorS
tandardImpl.java:224) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorSta
ndardImpl.java:102) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.executeQuery(JdbcSelectExecutor.java:91) ~[hibernat
e-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:165) ~[hibernate-core-
6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:142) ~[hibernate-core-
6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:132) ~[hibernate-core-
6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.loader.ast.internal.CollectionLoaderSingleKey.load(CollectionLoaderSingleKey.java:1
20) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.persister.collection.AbstractCollectionPersister.initialize(AbstractCollectionPersi
ster.java:748) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.event.internal.DefaultInitializeCollectionEventListener.onInitializeCollection(Defa
ultInitializeCollectionEventListener.java:69) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListener
GroupImpl.java:127) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.internal.SessionImpl.initializeCollection(SessionImpl.java:1724) ~[hibernate-core-6
.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.collection.spi.AbstractPersistentCollection.lambda$initialize$3(AbstractPersistentC
ollection.java:616) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.collection.spi.AbstractPersistentCollection.withTemporarySessionIfNeeded(AbstractPe
rsistentCollection.java:265) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.collection.spi.AbstractPersistentCollection.initialize(AbstractPersistentCollection
.java:614) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.collection.spi.AbstractPersistentCollection.forceInitialization(AbstractPersistentC
ollection.java:817) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.engine.internal.StatefulPersistenceContext.initializeNonLazyCollections(StatefulPer
sistenceContext.java:1169) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.engine.internal.StatefulPersistenceContext.initializeNonLazyCollections(StatefulPer
sistenceContext.java:1155) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:224) ~[hiberna
te-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.results.spi.ListResultsConsumer.consume(ListResultsConsumer.java:35) ~[hibernat
e-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.doExecuteQuery(JdbcSelectExecutorS
tandardImpl.java:224) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.internal.JdbcSelectExecutorStandardImpl.executeQuery(JdbcSelectExecutorSta
ndardImpl.java:102) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.executeQuery(JdbcSelectExecutor.java:91) ~[hibernat
e-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.sql.exec.spi.JdbcSelectExecutor.list(JdbcSelectExecutor.java:165) ~[hibernate-core-
6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.lambda$new$1(ConcreteSqmSelectQueryPl
an.java:152) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.withCacheableSqmInterpretation(Concre
teSqmSelectQueryPlan.java:442) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.query.sqm.internal.ConcreteSqmSelectQueryPlan.performList(ConcreteSqmSelectQueryPla
n.java:362) ~[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.query.sqm.internal.QuerySqmImpl.doList(QuerySqmImpl.java:380) ~[hibernate-core-6.6.
13.Final.jar:6.6.13.Final]
        at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:143) ~[hibernate-
core-6.6.13.Final.jar:6.6.13.Final]
        at org.hibernate.query.spi.AbstractSelectionQuery.getSingleResult(AbstractSelectionQuery.java:275) ~
[hibernate-core-6.6.13.Final.jar:6.6.13.Final]
        at org.springframework.data.jpa.repository.query.JpaQueryExecution$SingleEntityExecution.doExecute(J
paQueryExecution.java:224) ~[spring-data-jpa-3.4.5.jar:3.4.5]
        at org.springframework.data.jpa.repository.query.JpaQueryExecution.execute(JpaQueryExecution.java:93
) ~[spring-data-jpa-3.4.5.jar:3.4.5]
        at org.springframework.data.jpa.repository.query.AbstractJpaQuery.doExecute(AbstractJpaQuery.java:15
2) ~[spring-data-jpa-3.4.5.jar:3.4.5]
        at org.springframework.data.jpa.repository.query.AbstractJpaQuery.execute(AbstractJpaQuery.java:140)
 ~[spring-data-jpa-3.4.5.jar:3.4.5]
        at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMetho
dInvoker.java:170) ~[spring-data-commons-3.4.5.jar:3.4.5]
        at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodI
nvoker.java:158) ~[spring-data-commons-3.4.5.jar:3.4.5]
        at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExe
cutorMethodInterceptor.java:170) ~[spring-data-commons-3.4.5.jar:3.4.5]
        at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecu
torMethodInterceptor.java:149) ~[spring-data-commons-3.4.5.jar:3.4.5]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.j
ava:184) ~[spring-aop-6.2.6.jar:6.2.6]
        at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodIn
vokingMethodInterceptor.java:69) ~[spring-data-commons-3.4.5.jar:3.4.5]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.j
ava:184) ~[spring-aop-6.2.6.jar:6.2.6]
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(Tran
sactionAspectSupport.java:380) ~[spring-tx-6.2.6.jar:6.2.6]
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.
java:119) ~[spring-tx-6.2.6.jar:6.2.6]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.j
ava:184) ~[spring-aop-6.2.6.jar:6.2.6]
        at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExce
ptionTranslationInterceptor.java:138) ~[spring-tx-6.2.6.jar:6.2.6]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.j
ava:184) ~[spring-aop-6.2.6.jar:6.2.6]
        at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadat
aPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:136) ~[spring-data-jpa-3.4.5.jar:3.
4.5]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.j
ava:184) ~[spring-aop-6.2.6.jar:6.2.6]
        at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:223) ~[spring
-aop-6.2.6.jar:6.2.6]
        at jdk.proxy4/jdk.proxy4.$Proxy164.findByUsername(Unknown Source) ~[na:na]
        at com.baganov.pizzanat.config.DataInitializer.createTestUsers(DataInitializer.java:39) ~[main/:na]
        at com.baganov.pizzanat.config.DataInitializer.run(DataInitializer.java:34) ~[main/:na]
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) 
~[na:na]
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.j
ava:43) ~[na:na]
        at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:359) ~[spri
ng-aop-6.2.6.jar:6.2.6]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvo
cation.java:196) ~[spring-aop-6.2.6.jar:6.2.6]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.j
ava:163) ~[spring-aop-6.2.6.jar:6.2.6]
        at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(Tran
sactionAspectSupport.java:380) ~[spring-tx-6.2.6.jar:6.2.6]
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.
java:119) ~[spring-tx-6.2.6.jar:6.2.6]
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.j
ava:184) ~[spring-aop-6.2.6.jar:6.2.6]
        at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy
.java:728) ~[spring-aop-6.2.6.jar:6.2.6]
        at com.baganov.pizzanat.config.DataInitializer$$SpringCGLIB$$0.run(<generated>) ~[main/:na]
        at org.springframework.boot.SpringApplication.lambda$callRunner$5(SpringApplication.java:789) ~[spri
ng-boot-3.4.5.jar:3.4.5]
        at org.springframework.util.function.ThrowingConsumer$1.acceptWithException(ThrowingConsumer.java:82
) ~[spring-core-6.2.6.jar:6.2.6]
        at org.springframework.util.function.ThrowingConsumer.accept(ThrowingConsumer.java:60) ~[spring-core
-6.2.6.jar:6.2.6]
        at org.springframework.util.function.ThrowingConsumer$1.accept(ThrowingConsumer.java:86) ~[spring-co
re-6.2.6.jar:6.2.6]
        at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:797) ~[spring-boot-3
.4.5.jar:3.4.5]
        at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:788) ~[spring-boot-3
.4.5.jar:3.4.5]
        at org.springframework.boot.SpringApplication.lambda$callRunners$3(SpringApplication.java:773) ~[spr
ing-boot-3.4.5.jar:3.4.5]
        at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183) ~[na:na]
        at java.base/java.util.stream.SortedOps$SizedRefSortingSink.end(SortedOps.java:357) ~[na:na]
        at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:510) ~[na:na]
        at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499) ~[na:na]
        at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150) ~[na:na]
        at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173) ~[n
a:na]
        at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) ~[na:na]
        at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596) ~[na:na]
        at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:773) ~[spring-boot-
3.4.5.jar:3.4.5]
        at org.springframework.boot.SpringApplication.run(SpringApplication.java:325) ~[spring-boot-3.4.5.ja
r:3.4.5]
        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1362) ~[spring-boot-3.4.5.j
ar:3.4.5]
        at org.springframework.boot.SpringApplication.run(SpringApplication.java:1351) ~[spring-boot-3.4.5.j
ar:3.4.5]
        at com.baganov.pizzanat.PizzaNatApplication.main(PizzaNatApplication.java:14) ~[main/:na]
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) 
~[na:na]
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.j
ava:43) ~[na:na]
        at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
        at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:50) ~[spring-b
oot-devtools-3.4.5.jar:3.4.5]

2025-05-18T17:09:08.548+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] o.s.b.w.e.tomcat.GracefulShutdown
        : Commencing graceful shutdown. Waiting for active requests to complete
2025-05-18T17:09:08.560+03:00  INFO 76371 --- [PizzaNat] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown
        : Graceful shutdown complete
2025-05-18T17:09:08.589+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] j.LocalContainerEntityManagerFact
oryBean : Closing JPA EntityManagerFactory for persistence unit 'default'
2025-05-18T17:09:08.594+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] com.zaxxer.hikari.HikariDataSourc
e       : HikariPool-1 - Shutdown initiated...
2025-05-18T17:09:08.598+03:00  INFO 76371 --- [PizzaNat] [  restartedMain] com.zaxxer.hikari.HikariDataSourc
e       : HikariPool-1 - Shutdown completed.

> Task :bootRun FAILED

[Incubating] Problems report is available at: file:///Users/a123/IdeaProjects/PizzaNat/build/reports/problem
s/problems-report.html

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':bootRun'.
> Process 'command '/Users/a123/Library/Java/JavaVirtualMachines/corretto-17.0.13/Contents/Home/bin/java'' f
inished with non-zero exit value 1

* Try:
> Run with --stacktrace option to get the stack trace.
> Run with --info or --debug option to get more log output.
> Run with --scan to get full insights.
> Get more help at https://help.gradle.org.

BUILD FAILED in 1m 57s
4 actionable tasks: 4 executed

```

---

Я вижу, что у нас есть проблема с инициализацией приложения. Давайте проверим код, связанный с аутентификацией:

---

<details>
            <summary>Searched codebase "JwtAuthenticationFilter или AuthenticationProvider" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/main/java/com/baganov/pizzanat/security/JwtAuthenticationFilter.java` | L1-20 |
| `src/main/java/com/baganov/pizzanat/config/SecurityConfig.java` | L1-28 |
| `src/main/java/com/baganov/pizzanat/security/JwtAuthenticationFilter.java` | L20-52 |
| `src/main/java/com/baganov/pizzanat/security/JwtAuthenticationFilter.java` | L52-88 |
| `src/main/java/com/baganov/pizzanat/config/SecurityConfig.java` | L63-90 |
| `src/main/java/com/baganov/pizzanat/config/SecurityConfig.java` | L90-117 |
| `src/main/java/com/baganov/pizzanat/config/SecurityConfig.java` | L28-63 |
| `src/main/java/com/baganov/pizzanat/service/AuthService.java` | L1-16 |
| `src/main/java/com/baganov/pizzanat/service/AuthService.java` | L49-73 |
| `src/main/java/com/baganov/pizzanat/security/JwtService.java` | L1-52 |
| `src/main/java/com/baganov/pizzanat/security/JwtService.java` | L52-89 |
| `src/main/java/com/baganov/pizzanat/service/AuthService.java` | L16-49 |
| `src/main/java/com/baganov/pizzanat/controller/DebugController.java` | L24-68 |
| `src/main/java/com/baganov/pizzanat/security/JwtService.java` | L89-121 |
| `src/main/resources/application.properties` | L61-84 |
| `src/main/java/com/baganov/pizzanat/model/dto/auth/AuthResponse.java` | L1-19 |
| `src/main/java/com/baganov/pizzanat/controller/AuthController.java` | L1-17 |
| `src/main/java/com/baganov/pizzanat/model/dto/auth/AuthRequest.java` | L1-23 |
| `src/main/java/com/baganov/pizzanat/controller/AuthController.java` | L46-61 |
| `src/main/resources/application.properties` | L1-61 |
| `src/main/java/com/baganov/pizzanat/controller/AuthController.java` | L17-46 |
| `src/main/java/com/baganov/pizzanat/controller/DebugController.java` | L1-24 |
| `build.gradle` | L1-65 |
| `src/test/resources/application-test.properties` | L1-41 |
| `src/main/java/com/baganov/pizzanat/service/UserService.java` | L1-17 |

</details>

---

Давайте проверим, что происходит при попытке аутентификации:

---

```bash
curl -X POST -H "Content-Type: application/json" -d '{"username": "test", "password": "test123"}' http://localhost:8080/api/v1/auth/login
```

```
a123@MacBookAir PizzaNat % curl -X POST -H "Content-Type: application/json" -d '{"username": "test", "passwo
rd": "test123"}' http://loccurl -X POST -H "Content-Type: application/json" -d '{"username": "test", "passwo
rd": "test123"}' http://localhost:8080/api/v1/auth/login
curl: (7) Failed to connect to localhost port 8080 after 0 ms: Couldn't connect to server
a123@MacBookAir PizzaNat %
```

---

Я вижу несколько проблем:

1. Приложение не запускается из-за ошибки в `DataInitializer`:
```
java.util.ConcurrentModificationException: null
        at java.base/java.util.ArrayList$Itr.checkForComodification(ArrayList.java:1013)
```

2. В логах видно, что есть проблема с циклической зависимостью в конфигурации Spring Security.

Давайте исправим эти проблемы:

---

<details>
            <summary>Searched codebase "DataInitializer" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/main/java/com/baganov/pizzanat/config/DataInitializer.java` | L1-24 |
| `src/main/java/com/baganov/pizzanat/config/DataInitializer.java` | L24-64 |
| `src/main/java/com/baganov/pizzanat/config/DataInitializer.java` | L64-90 |
| `src/main/java/com/baganov/pizzanat/util/ImageUploader.java` | L25-58 |
| `src/main/resources/db/migration/V1__init_schema.sql` | L112-131 |
| `deep-clean.sh` | L60-111 |
| `src/main/java/com/baganov/pizzanat/service/InitService.java` | L1-26 |
| `src/main/java/com/baganov/pizzanat/service/InitService.java` | L26-72 |
| `src/main/java/com/baganov/pizzanat/util/ImageUploader.java` | L1-25 |
| `src/main/resources/db/migration/V4__init_product_data.sql` | L21-34 |
| `src/main/java/com/baganov/pizzanat/service/InitService.java` | L87-125 |
| `src/main/resources/db/migration/V4__init_product_data.sql` | L1-21 |
| `deep-clean.sh` | L45-60 |
| `src/main/resources/db/migration/V1__init_schema.sql` | L1-56 |
| `deep-clean.sh` | L1-45 |
| `run.sh` | L96-156 |
| `src/test/java/com/baganov/pizzanat/integration/OrderIntegrationTest.java` | L72-106 |
| `src/main/resources/db/migration/V1__init_schema.sql` | L56-112 |
| `compose.yaml` | L1-76 |
| `docker-compose.yaml` | L56-117 |
| `src/main/java/com/baganov/pizzanat/util/ImageUploader.java` | L80-112 |
| `src/main/resources/db/migration/V4__init_product_data.sql` | L34-47 |
| `src/main/java/com/baganov/pizzanat/model/entity/Role.java` | L1-47 |
| `src/main/java/com/baganov/pizzanat/model/entity/Category.java` | L1-59 |
| `src/main/java/com/baganov/pizzanat/util/ImageUploader.java` | L58-80 |

</details>

---

Я вижу несколько проблем:

1. Проблема с циклическими зависимостями в `Role` и `User` классах
2. Проблема с инициализацией данных в `DataInitializer`

Давайте исправим эти проблемы:

1. Сначала исправим циклические зависимости в `Role` и `User`:

---

```diff
  
  import jakarta.persistence.*;
- import lombok.AllArgsConstructor;
- import lombok.Builder;
- import lombok.Data;
- import lombok.NoArgsConstructor;
+ import lombok.*;
  
  import java.time.LocalDateTime;
```

```diff
      private LocalDateTime updatedAt;
  
+     @ToString.Exclude
+     @EqualsAndHashCode.Exclude
      @ManyToMany(mappedBy = "roles")
      private Set<User> users = new HashSet<>();
```

---

2. Теперь исправим `DataInitializer`:

---

```diff
      @Transactional
      public void run(String... args) {
-         // Добавляем тестовых пользователей, если их еще нет
+         initializeRoles();
          createTestUsers();
      }
+ 
+     private void initializeRoles() {
+         if (roleRepository.count() == 0) {
+             log.info("Инициализация ролей");
+             Role userRole = new Role();
+             userRole.setName("ROLE_USER");
+             roleRepository.save(userRole);
+ 
+             Role adminRole = new Role();
+             adminRole.setName("ROLE_ADMIN");
+             roleRepository.save(adminRole);
+             log.info("Роли успешно созданы");
+         }
+     }
  
      private void createTestUsers() {
-         // Проверяем, есть ли уже пользователь с именем "admin"
          if (userRepository.findByUsername("admin").isEmpty()) {
              log.info("Создаю тестового пользователя 'admin'");
```

```diff
          }
  
-         // Создаем обычного пользователя
          if (userRepository.findByUsername("user").isEmpty()) {
              log.info("Создаю тестового пользователя 'user'");
```

---

3. Теперь давайте исправим `User` класс:

---

```diff
  
  import jakarta.persistence.*;
- import lombok.AllArgsConstructor;
- import lombok.Builder;
- import lombok.Data;
- import lombok.NoArgsConstructor;
+ import lombok.*;
  import org.springframework.security.core.GrantedAuthority;
  import org.springframework.security.core.authority.SimpleGrantedAuthority;
```

```diff
      private LocalDateTime updatedAt;
  
+     @ToString.Exclude
+     @EqualsAndHashCode.Exclude
      @ManyToMany(fetch = FetchType.EAGER)
-     @JoinTable(name = "user_roles", joinColumns = @JoinColumn(name = "user_id"), inverseJoinColumns = @JoinColumn(name = "role_id"))
+     @JoinTable(
+             name = "user_roles",
+             joinColumns = @JoinColumn(name = "user_id"),
+             inverseJoinColumns = @JoinColumn(name = "role_id"))
      private Set<Role> roles = new HashSet<>();
+ 
+     @PrePersist
+     protected void onCreate() {
+         createdAt = LocalDateTime.now();
+         updatedAt = LocalDateTime.now();
+     }
+ 
+     @PreUpdate
+     protected void onUpdate() {
+         updatedAt = LocalDateTime.now();
+     }
  
      @Override
      public Collection<? extends GrantedAuthority> getAuthorities() {
          return roles.stream()
                  .map(role -> new SimpleGrantedAuthority(role.getName()))
-                 .collect(Collectors.toList());
+                 .collect(Collectors.toSet());
      }
  
```

```diff
          return isActive;
      }
- 
-     @PrePersist
-     protected void onCreate() {
-         createdAt = LocalDateTime.now();
-         updatedAt = LocalDateTime.now();
-     }
- 
-     @PreUpdate
-     protected void onUpdate() {
-         updatedAt = LocalDateTime.now();
-     }
  }
```

---

Теперь давайте перезапустим приложение и попробуем аутентификацию:

---

```bash
./gradlew bootRun
```

```
        : HHH000412: Hibernate ORM core version 6.6.13.Final
2025-05-18T17:11:59.604+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] o.h.c.internal.RegionFactoryIniti
ator    : HHH000026: Second-level cache disabled
2025-05-18T17:11:59.783+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] o.s.o.j.p.SpringPersistenceUnitIn
fo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2025-05-18T17:11:59.802+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] com.zaxxer.hikari.HikariDataSourc
e       : HikariPool-1 - Starting...
2025-05-18T17:11:59.840+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] com.zaxxer.hikari.pool.HikariPool
        : HikariPool-1 - Added connection org.postgresql.jdbc.PgConnection@511887ea
2025-05-18T17:11:59.841+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] com.zaxxer.hikari.HikariDataSourc
e       : HikariPool-1 - Start completed.
2025-05-18T17:11:59.895+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] org.hibernate.orm.connections.poo
ling    : HHH10001005: Database info:
        Database JDBC URL [Connecting through datasource 'HikariDataSource (HikariPool-1)']
        Database driver: undefined/unknown
        Database version: 15.13
        Autocommit mode: undefined/unknown
        Isolation level: undefined/unknown
        Minimum pool size: undefined/unknown
        Maximum pool size: undefined/unknown
2025-05-18T17:12:00.678+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] o.h.e.t.j.p.i.JtaPlatformInitiato
r       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platf
orm integration)
2025-05-18T17:12:01.149+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] j.LocalContainerEntityManagerFact
oryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-05-18T17:12:01.452+03:00  WARN 77637 --- [PizzaNat] [  restartedMain] o.s.aop.framework.CglibAopProxy  
        : Unable to proxy interface-implementing method [public final void org.springframework.web.filter.On
cePerRequestFilter.doFilter(jakarta.servlet.ServletRequest,jakarta.servlet.ServletResponse,jakarta.servlet.F
ilterChain) throws jakarta.servlet.ServletException,java.io.IOException] because it is marked as final, cons
ider using interface-based JDK proxies instead.
2025-05-18T17:12:01.452+03:00  WARN 77637 --- [PizzaNat] [  restartedMain] o.s.aop.framework.CglibAopProxy  
        : Unable to proxy interface-implementing method [public final void org.springframework.web.filter.Ge
nericFilterBean.init(jakarta.servlet.FilterConfig) throws jakarta.servlet.ServletException] because it is ma
rked as final, consider using interface-based JDK proxies instead.
2025-05-18T17:12:01.469+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.config.MinioCo
nfig    : Инициализация MinIO клиента с параметрами: endpoint=http://localhost:9000, bucket=pizzanat
2025-05-18T17:12:01.735+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.config.MinioCo
nfig    : Бакет 'pizzanat' уже существует
2025-05-18T17:12:01.940+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] eAuthenticationProviderManagerCon
figurer : Global AuthenticationManager configured with AuthenticationProvider bean with name authenticationP
rovider
2025-05-18T17:12:01.940+03:00  WARN 77637 --- [PizzaNat] [  restartedMain] r$InitializeUserDetailsManagerCon
figurer : Global AuthenticationManager configured with an AuthenticationProvider bean. UserDetailsService be
ans will not be used by Spring Security for automatically configuring username/password login. Consider remo
ving the AuthenticationProvider bean. Alternatively, consider using the UserDetailsService in a manually ins
tantiated DaoAuthenticationProvider. If the current configuration is intentional, to turn off this warning, 
increase the logging level of 'org.springframework.security.config.annotation.authentication.configuration.I
nitializeUserDetailsBeanManagerConfigurer' to ERROR
2025-05-18T17:12:01.964+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] o.s.d.j.r.query.QueryEnhancerFact
ory     : Hibernate is in classpath; If applicable, HQL parser will be used.
2025-05-18T17:12:04.079+03:00 DEBUG 77637 --- [PizzaNat] [  restartedMain] s.w.s.m.m.a.RequestMappingHandler
Mapping : 32 mappings in 'requestMappingHandlerMapping'
2025-05-18T17:12:04.198+03:00 DEBUG 77637 --- [PizzaNat] [  restartedMain] o.s.w.s.handler.SimpleUrlHandlerM
apping  : Patterns [/webjars/**, /**, /swagger-ui*/*swagger-initializer.js, /swagger-ui*/**] in 'resourceHan
dlerMapping'
2025-05-18T17:12:04.214+03:00 DEBUG 77637 --- [PizzaNat] [  restartedMain] c.b.pizzanat.config.SecurityConfi
g       : Configuring security with public URLs: [/api/v1/auth/**, /api/v1/products/**, /api/v1/categories/*
*, /api/v1/delivery/locations, /v3/api-docs/**, /swagger-ui/**, /swagger-ui.html, /webjars/**, /, /debug/**]
2025-05-18T17:12:04.214+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.b.pizzanat.config.SecurityConfi
g       : Режим без проверки JWT: false
2025-05-18T17:12:04.276+03:00 DEBUG 77637 --- [PizzaNat] [  restartedMain] o.s.s.web.DefaultSecurityFilterCh
ain     : Will secure any request with filters: DisableEncodeUrlFilter, WebAsyncManagerIntegrationFilter, Se
curityContextHolderFilter, HeaderWriterFilter, CorsFilter, LogoutFilter, JwtAuthenticationFilter$$SpringCGLI
B$$0, RequestCacheAwareFilter, SecurityContextHolderAwareRequestFilter, AnonymousAuthenticationFilter, Sessi
onManagementFilter, ExceptionTranslationFilter, AuthorizationFilter
2025-05-18T17:12:04.376+03:00 DEBUG 77637 --- [PizzaNat] [  restartedMain] s.w.s.m.m.a.RequestMappingHandler
Adapter : ControllerAdvice beans: 0 @ModelAttribute, 0 @InitBinder, 1 RequestBodyAdvice, 1 ResponseBodyAdvic
e
2025-05-18T17:12:04.426+03:00 DEBUG 77637 --- [PizzaNat] [  restartedMain] .m.m.a.ExceptionHandlerExceptionR
esolver : ControllerAdvice beans: 1 @ExceptionHandler, 1 ResponseBodyAdvice
2025-05-18T17:12:04.692+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] o.s.b.d.a.OptionalLiveReloadServe
r       : LiveReload server is running on port 35729
2025-05-18T17:12:04.722+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] o.s.b.w.embedded.tomcat.TomcatWeb
Server  : Tomcat started on port 8080 (http) with context path '/'
2025-05-18T17:12:04.733+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.PizzaNatApplic
ation   : Started PizzaNatApplication in 40.361 seconds (process running for 41.312)
Hibernate: 
    select
        count(*) 
    from
        roles r1_0
Hibernate: 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.is_active,
        u1_0.last_name,
        u1_0.password,
        u1_0.phone,
        u1_0.updated_at,
        u1_0.username 
    from
        users u1_0 
    where
        u1_0.username=?
Hibernate: 
    select
        r1_0.user_id,
        r1_1.id,
        r1_1.created_at,
        r1_1.name,
        r1_1.updated_at 
    from
        user_roles r1_0 
    join
        roles r1_1 
            on r1_1.id=r1_0.role_id 
    where
        r1_0.user_id=?
Hibernate: 
    select
        u1_0.id,
        u1_0.created_at,
        u1_0.email,
        u1_0.first_name,
        u1_0.is_active,
        u1_0.last_name,
        u1_0.password,
        u1_0.phone,
        u1_0.updated_at,
        u1_0.username 
    from
        users u1_0 
    where
        u1_0.username=?
Hibernate: 
    select
        r1_0.user_id,
        r1_1.id,
        r1_1.created_at,
        r1_1.name,
        r1_1.updated_at 
    from
        user_roles r1_0 
    join
        roles r1_1 
            on r1_1.id=r1_0.role_id 
    where
        r1_0.user_id=?
2025-05-18T17:12:04.844+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.service.InitSe
rvice   : Начало синхронизации изображений продуктов
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.image_url=? 
    fetch
        first ? rows only
2025-05-18T17:12:04.910+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.service.InitSe
rvice   : Синхронизация изображений продуктов завершена
2025-05-18T17:12:04.910+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.util.ImageUplo
ader    : Начало синхронизации данных о продуктах
Hibernate: 
    select
        c1_0.id,
        c1_0.created_at,
        c1_0.description,
        c1_0.display_order,
        c1_0.image_url,
        c1_0.is_active,
        c1_0.name,
        c1_0.updated_at 
    from
        categories c1_0 
    where
        c1_0.name=?
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
2025-05-18T17:12:04.978+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.util.ImageUplo
ader    : Синхронизация данных о продуктах завершена
2025-05-18T17:12:04.981+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.util.ImageUplo
ader    : Начало синхронизации данных о продуктах
Hibernate: 
    select
        c1_0.id,
        c1_0.created_at,
        c1_0.description,
        c1_0.display_order,
        c1_0.image_url,
        c1_0.is_active,
        c1_0.name,
        c1_0.updated_at 
    from
        categories c1_0 
    where
        c1_0.name=?
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
Hibernate: 
    select
        p1_0.id 
    from
        products p1_0 
    where
        p1_0.name=? 
    fetch
        first ? rows only
2025-05-18T17:12:05.034+03:00  INFO 77637 --- [PizzaNat] [  restartedMain] c.baganov.pizzanat.util.ImageUplo
ader    : Синхронизация данных о продуктах завершена
<==========---> 80% EXECUTING [6m 14s]
> :bootRun
```

---

Приложение успешно запустилось. Теперь давайте попробуем зарегистрировать нового пользователя:

---

```bash
curl -X POST -H "Content-Type: application/json" -d '{"username": "test", "password": "test123", "email": "test@example.com", "firstName": "Test", "lastName": "User", "phone": "+79001234567"}' http://localhost:8080/api/v1/auth/register
```

```
curl: (7) Failed to connect to localhost port 8080 after 0 ms: Couldn't connect to server

```

---

Похоже, что приложение не запущено. Давайте запустим его в фоновом режиме:

---

```bash
./gradlew bootRun &
```

---

Подождем немного, пока приложение запустится, и попробуем снова зарегистрировать пользователя:

---

```bash
sleep 30 && curl -X POST -H "Content-Type: application/json" -d '{"username": "test", "password": "test123", "email": "test@example.com", "firstName": "Test", "lastName": "User", "phone": "+79001234567"}' http://localhost:8080/api/v1/auth/register
```

```
a123@MacBookAir PizzaNat % 

```

---

Теперь попробуем аутентифицироваться:

---

```bash
curl -X POST -H "Content-Type: application/json" -d '{"username": "test", "password": "test123"}' http://localhost:8080/api/v1/auth/login
```

```
a123@MacBookAir PizzaNat % 

```

---



---

_**User**_

75181efc-2aef-4c63-8ff2-47f60dd660b1 продолжай

---

_**Assistant**_

Из логов я вижу, что есть несколько проблем:

1. При попытке регистрации используется GET метод вместо POST:
```
Request method 'GET' is not supported
```

2. При попытке аутентификации пользователь не найден:
```
Failed to find user 'test'
```

Давайте проверим контроллер аутентификации:

---

<details>
            <summary>Searched codebase "AuthController или AuthService" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/main/java/com/baganov/pizzanat/controller/AuthController.java` | L1-17 |
| `src/main/java/com/baganov/pizzanat/controller/AuthController.java` | L17-46 |
| `src/main/java/com/baganov/pizzanat/service/AuthService.java` | L1-16 |
| `src/main/java/com/baganov/pizzanat/service/AuthService.java` | L16-49 |
| `src/main/java/com/baganov/pizzanat/controller/AuthController.java` | L46-61 |
| `src/main/java/com/baganov/pizzanat/service/AuthService.java` | L49-73 |
| `src/main/java/com/baganov/pizzanat/controller/DebugController.java` | L24-68 |
| `src/main/java/com/baganov/pizzanat/model/dto/auth/AuthRequest.java` | L1-23 |
| `src/main/java/com/baganov/pizzanat/controller/DebugController.java` | L1-24 |
| `src/main/java/com/baganov/pizzanat/model/dto/auth/AuthResponse.java` | L1-19 |
| `src/main/java/com/baganov/pizzanat/controller/AdminController.java` | L1-45 |
| `src/main/java/com/baganov/pizzanat/security/JwtAuthenticationFilter.java` | L52-88 |
| `src/main/java/com/baganov/pizzanat/controller/OrderController.java` | L19-57 |
| `src/main/java/com/baganov/pizzanat/security/JwtAuthenticationFilter.java` | L20-52 |
| `src/main/java/com/baganov/pizzanat/controller/OrderController.java` | L57-91 |
| `src/main/java/com/baganov/pizzanat/service/UserService.java` | L17-63 |
| `src/main/java/com/baganov/pizzanat/controller/OrderController.java` | L1-19 |
| `src/main/java/com/baganov/pizzanat/controller/CartController.java` | L1-26 |
| `src/main/java/com/baganov/pizzanat/service/UserService.java` | L1-17 |
| `src/main/java/com/baganov/pizzanat/security/JwtAuthenticationFilter.java` | L1-20 |
| `src/main/java/com/baganov/pizzanat/security/JwtService.java` | L89-121 |
| `src/main/java/com/baganov/pizzanat/controller/AdminOrderController.java` | L18-50 |
| `src/main/java/com/baganov/pizzanat/controller/AdminOrderController.java` | L1-18 |
| `src/main/java/com/baganov/pizzanat/controller/CartController.java` | L124-153 |
| `src/main/java/com/baganov/pizzanat/config/SecurityConfig.java` | L63-90 |

</details>

---

Давайте проверим конфигурацию безопасности:

---

<details>
            <summary>Searched codebase "SecurityConfig или WebSecurityConfig" • **25** results</summary>
        
| File | Lines |
|------|-------|
| `src/main/java/com/baganov/pizzanat/config/SecurityConfig.java` | L1-28 |
| `src/main/java/com/baganov/pizzanat/config/SecurityConfig.java` | L63-90 |
| `src/main/java/com/baganov/pizzanat/config/SecurityConfig.java` | L90-117 |
| `src/main/java/com/baganov/pizzanat/config/SecurityConfig.java` | L28-63 |
| `src/main/java/com/baganov/pizzanat/config/PasswordEncoderConfig.java` | L1-19 |
| `src/main/java/com/baganov/pizzanat/config/WebConfig.java` | L1-18 |
| `src/main/java/com/baganov/pizzanat/security/JwtAuthenticationFilter.java` | L1-20 |
| `src/main/java/com/baganov/pizzanat/security/JwtAuthenticationFilter.java` | L20-52 |
| `src/main/resources/application-dev.properties` | L1-37 |
| `build.gradle` | L1-65 |
| `src/main/java/com/baganov/pizzanat/security/JwtAuthenticationFilter.java` | L52-88 |
| `src/main/resources/application.properties` | L61-84 |
| `src/main/java/com/baganov/pizzanat/security/JwtService.java` | L1-52 |
| `src/main/resources/application.properties` | L1-61 |
| `src/main/java/com/baganov/pizzanat/config/DataInitializer.java` | L1-24 |
| `src/main/java/com/baganov/pizzanat/security/JwtService.java` | L89-121 |
| `src/main/java/com/baganov/pizzanat/config/MailConfig.java` | L1-57 |
| `src/main/java/com/baganov/pizzanat/service/AuthService.java` | L1-16 |
| `src/main/java/com/baganov/pizzanat/security/JwtService.java` | L52-89 |
| `src/main/java/com/baganov/pizzanat/controller/DebugController.java` | L1-24 |
| `build.gradle` | L65-84 |
| `src/main/java/com/baganov/pizzanat/config/RedisConfig.java` | L1-22 |
| `src/main/java/com/baganov/pizzanat/config/DataInitializer.java` | L24-51 |
| `src/main/java/com/baganov/pizzanat/controller/AdminController.java` | L1-45 |
| `src/main/java/com/baganov/pizzanat/controller/OrderController.java` | L1-19 |

</details>

---

Я вижу несколько проблем:

1. В `application.properties` включен режим отладки для Spring Security:
```properties
logging.level.org.springframework.security=DEBUG
```

2. В `SecurityConfig` настроены публичные URL:
```java
private static final String[] PUBLIC_URLS = {
    "/api/v1/auth/**",
    "/api/v1/products/**",
    "/api/v1/categories/**",
    "/api/v1/delivery/locations",
    "/v3/api-docs/**",
    "/swagger-ui/**",
    "/swagger-ui.html",
    "/webjars/**",
    "/",
    "/debug/**"
};
```

3. В `AuthService` есть метод для регистрации:
```java
@Transactional
public AuthResponse register(RegisterRequest request) {
    User user = User.builder()
            .username(request.getUsername())
            .email(request.getEmail())
            .password(request.getPassword()) // Пароль будет зашифрован в UserService
            .firstName(request.getFirstName())
            .lastName(request.getLastName())
            .phone(request.getPhone())
            .build();

    user = userService.createUser(user);
    String token = jwtService.generateToken(user);
    return AuthResponse.builder()
            .token(token)
            .username(user.getUsername())
            .email(user.getEmail())
            .firstName(user.getFirstName())
            .lastName(user.getLastName())
            .build();
}
```

Давайте сначала зарегистрируем пользователя с правильным методом POST:

---



---



---

