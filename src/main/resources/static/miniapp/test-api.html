<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–¢–µ—Å—Ç Telegram API 7.7</title>
    
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=103585127', 'ym');

        ym(103585127, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/103585127" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    
    <!-- –õ–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è Telegram WebApp API -->
    <script src="telegram-web-app.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .info-box {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007acc;
        }
        .error-box {
            background: #ffe6e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ff4444;
        }
        .success-box {
            background: #e6ffe6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #44ff44;
        }
        button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #005a99;
        }
        #log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç Telegram API 7.7</h1>
    
    <div class="info-box">
        <h3>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API</h3>
        <p><strong>–í–µ—Ä—Å–∏—è API:</strong> <span id="api-version">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p><strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> <span id="api-platform">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p><strong>requestContact –¥–æ—Å—Ç—É–ø–µ–Ω:</strong> <span id="request-contact-available">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
    </div>
    
    <div class="info-box">
        <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π</h3>
        <button onclick="testRequestContact()">üì± –¢–µ—Å—Ç requestContact()</button>
        <button onclick="testShowAlert()">üîî –¢–µ—Å—Ç showAlert()</button>
        <button onclick="testShowPopup()">üí¨ –¢–µ—Å—Ç showPopup()</button>
        <button onclick="clearLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
    
    <div class="info-box">
        <h3>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h3>
        <div id="log"></div>
    </div>

    <script>
        let tg = window.Telegram?.WebApp;
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function updateDiagnostics() {
            if (tg) {
                document.getElementById('api-version').textContent = tg.version || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                document.getElementById('api-platform').textContent = tg.platform || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                document.getElementById('request-contact-available').textContent = 
                    typeof tg.requestContact === 'function' ? '‚úÖ –î–∞' : '‚ùå –ù–µ—Ç';
                
                log(`üîç Telegram API –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω`);
                log(`üìä –í–µ—Ä—Å–∏—è: ${tg.version}`);
                log(`üì± –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${tg.platform}`);
                log(`üìû requestContact: ${typeof tg.requestContact}`);
                log(`üìß requestWriteAccess: ${typeof tg.requestWriteAccess}`);
                log(`üîî showAlert: ${typeof tg.showAlert}`);
                log(`üí¨ showPopup: ${typeof tg.showPopup}`);
                
                // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
                tg.onEvent('contactRequested', (data) => {
                    log(`üìû –°–û–ë–´–¢–ò–ï contactRequested: ${JSON.stringify(data)}`);
                });
                
                tg.onEvent('writeAccessRequested', (data) => {
                    log(`‚úçÔ∏è –°–û–ë–´–¢–ò–ï writeAccessRequested: ${JSON.stringify(data)}`);
                });
                
            } else {
                document.getElementById('api-version').textContent = 'API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                document.getElementById('api-platform').textContent = 'API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                document.getElementById('request-contact-available').textContent = '‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                log('‚ùå Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        }
        
        function testRequestContact() {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º requestContact()...');
            
            if (!tg) {
                log('‚ùå Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                return;
            }
            
            if (typeof tg.requestContact !== 'function') {
                log('‚ùå requestContact –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π');
                return;
            }
            
            try {
                tg.requestContact();
                log('‚úÖ requestContact() –≤—ã–∑–≤–∞–Ω –±–µ–∑ –æ—à–∏–±–æ–∫');
                log('‚è±Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è contactRequested...');
                
                // –¢–∞–π–º–∞—É—Ç –¥–ª—è —Ç–µ—Å—Ç–∞
                setTimeout(() => {
                    log('‚è∞ –¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥ –∏—Å—Ç–µ–∫');
                }, 10000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ requestContact: ${error.message}`);
            }
        }
        
        function testShowAlert() {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º showAlert()...');
            
            if (!tg || typeof tg.showAlert !== 'function') {
                log('‚ùå showAlert –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                return;
            }
            
            try {
                tg.showAlert('–¢–µ—Å—Ç showAlert() —É—Å–ø–µ—à–µ–Ω!');
                log('‚úÖ showAlert() –≤—ã–∑–≤–∞–Ω –±–µ–∑ –æ—à–∏–±–æ–∫');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ showAlert: ${error.message}`);
            }
        }
        
        function testShowPopup() {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º showPopup()...');
            
            if (!tg || typeof tg.showPopup !== 'function') {
                log('‚ùå showPopup –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                return;
            }
            
            try {
                tg.showPopup({
                    title: '–¢–µ—Å—Ç Popup',
                    message: '–≠—Ç–æ —Ç–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ showPopup()',
                    buttons: [
                        { type: 'ok', text: 'OK' },
                        { type: 'cancel', text: '–û—Ç–º–µ–Ω–∞' }
                    ]
                }, (button) => {
                    log(`‚úÖ showPopup –æ—Ç–≤–µ—Ç: ${button}`);
                });
                log('‚úÖ showPopup() –≤—ã–∑–≤–∞–Ω –±–µ–∑ –æ—à–∏–±–æ–∫');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ showPopup: ${error.message}`);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            log('üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            if (tg) {
                tg.ready();
                tg.expand();
                log('üöÄ Telegram WebApp –≥–æ—Ç–æ–≤');
            }
            
            updateDiagnostics();
        });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫
        window.addEventListener('error', (e) => {
            log(`üö® JavaScript –æ—à–∏–±–∫–∞: ${e.message} –≤ ${e.filename}:${e.lineno}`);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            log(`üö® Promise –æ—à–∏–±–∫–∞: ${e.reason}`);
        });
    </script>
</body>
</html>
